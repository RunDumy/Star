"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[725,3106],{725:(e,t,n)=>{n.r(t),n.d(t,{AgoraUIKitLiveStream:()=>p});var r=n(3857),o=n(3081),a=n.n(o),s=n(7534),c=n(5361),i=n(4141),u=n(4232),l=n(7876),d=n(5364);function p(e){var t,n=e.streamId,o=e.isHost,p=void 0!==o&&o,f=(0,u.useState)(null),h=f[0],m=f[1],v=(0,u.useState)(!0),b=v[0],x=v[1],y=(0,u.useState)(null),g=y[0],_=y[1],E=(0,s.T)(),w=E.socket;if(E.currentUser,(0,u.useEffect)(function(){var e;(e=(0,r.A)(a().mark(function e(){var t,r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.N.auth.getSession();case 3:if(t=e.sent.data.session){e.next=9;break}return _("Please log in to view live streams"),x(!1),e.abrupt("return");case 9:return e.next=11,fetch("".concat("http://localhost:5000","/api/v1/live-stream/").concat(n),{headers:{Authorization:"Bearer ".concat(t.access_token)}});case 11:if(!(r=e.sent).ok){e.next=20;break}return e.next=15,r.json();case 15:m(e.sent.stream),e.next=21;break;case 20:_("Stream not found or inactive");case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),_("Failed to load stream"),console.error("Error fetching stream:",e.t0);case 27:return e.prev=27,x(!1),e.finish(27);case 30:case"end":return e.stop()}},e,null,[[0,23,27,30]])})),function(){return e.apply(this,arguments)})()},[n]),(0,u.useEffect)(function(){w&&h&&w.emit("join_stream",{streamId:h.id})},[w,h]),b)return(0,l.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,l.jsx)("div",{className:"text-white",children:"Loading stream..."})});if(g||!h)return(0,l.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,l.jsx)("div",{className:"text-red-400",children:g||"Stream not available"})});var N={appId:d.env.NEXT_PUBLIC_AGORA_APP_ID,channel:h.channel_name,token:h.agora_token},A={EndCall:(t=(0,r.A)(a().mark(function e(){var t;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=8;break}return e.next=3,c.N.auth.getSession();case 3:if(!(t=e.sent.data.session)){e.next=8;break}return e.next=8,fetch("".concat("http://localhost:5000","/api/v1/live-stream/").concat(n,"/end"),{method:"POST",headers:{Authorization:"Bearer ".concat(t.access_token)}});case 8:console.log("Call ended");case 9:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})};return(0,l.jsxs)("div",{className:"w-full h-full bg-black rounded-lg overflow-hidden",children:[(0,l.jsxs)("div",{className:"p-4 bg-gradient-to-r from-purple-900 to-blue-900",children:[(0,l.jsx)("h2",{className:"text-white text-xl font-bold",children:h.title}),(0,l.jsxs)("p",{className:"text-gray-300",children:["Hosted by ",h.username," (",h.zodiac_sign,")"]})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(i.Ay,{rtcProps:N,callbacks:A,styleProps:{UIKitContainer:{height:"600px",width:"100%"},localBtnContainer:{backgroundColor:"#1a1a1a"},localBtnStyles:{muteLocalAudio:{backgroundColor:"#4a5568"},muteLocalVideo:{backgroundColor:"#4a5568"},switchCamera:{backgroundColor:"#4a5568"},endCall:{backgroundColor:"#e53e3e"}}}}),(0,l.jsxs)("div",{className:"absolute top-4 left-4 bg-black/70 text-white p-3 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,l.jsx)("span",{className:"text-sm font-medium",children:"LIVE"})]}),(0,l.jsx)("p",{className:"text-xs text-gray-300 mt-1",children:"Cosmic Stream"})]})]})]})}},3857:(e,t,n)=>{function r(e,t,n,r,o,a,s){try{var c=e[a](s),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var s=e.apply(t,n);function c(e){r(s,o,a,c,i,"next",e)}function i(e){r(s,o,a,c,i,"throw",e)}c(void 0)})}}n.d(t,{A:()=>o})},5361:(e,t,n)=>{n.d(t,{N:()=>s});var r=n(3857),o=n(3081),a=n.n(o),s={auth:{getUser:function(){return(0,r.A)(a().mark(function e(){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{user:null}});case 1:case"end":return e.stop()}},e)}))()},signOut:function(){return(0,r.A)(a().mark(function e(){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)}))()},onAuthStateChange:function(e){return{data:{subscription:null},unsubscribe:function(){}}}},from:function(e){return{select:function(e){return{eq:function(e,t){return{single:function(){return Promise.resolve({data:null,error:null})}}}}},insert:function(e){return Promise.resolve({data:null,error:null})},update:function(e){return{eq:function(e,t){return Promise.resolve({data:null,error:null})}}},delete:function(){return{eq:function(e,t){return Promise.resolve({data:null,error:null})}}}}},channel:function(e){return{on:function(e,t){return this},subscribe:function(e){return e&&e(),this},unsubscribe:function(){return Promise.resolve()}}},removeChannel:function(e){return Promise.resolve()}}},7534:(e,t,n)=>{n.d(t,{T:()=>x,p:()=>b});var r=n(3857),o=n(236),a=n(2969),s=n(3081),c=n.n(s),i=n(1040),u=n(4232),l=n(2692),d=n(7876),p=n(5364);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m=(0,u.createContext)(),v=function(e,t){switch(t.type){case"SET_ONLINE_USERS":return h(h({},e),{},{onlineUsers:new Map(t.payload)});case"UPDATE_USER_POSITION":var n=new Map(e.onlineUsers);return n.set(t.payload.userId,t.payload),h(h({},e),{},{onlineUsers:n});case"ADD_CONSTELLATION":var r=new Map(e.constellations);return r.set(t.payload.id,t.payload),h(h({},e),{},{constellations:r});case"SET_CURRENT_USER":return h(h({},e),{},{currentUser:t.payload});case"SET_SOCKET":return h(h({},e),{},{socket:t.payload});case"SET_CONNECTED":return h(h({},e),{},{isConnected:t.payload});case"ADD_RECENT_ACTION":return h(h({},e),{},{recentActions:[t.payload].concat((0,o.A)(e.recentActions.slice(0,9)))});default:return e}},b=function(e){var t,n,o,a=e.children,s=(0,u.useReducer)(v,{onlineUsers:new Map,constellations:new Map,currentUser:null,socket:null,isConnected:!1,recentActions:[]}),f=s[0],b=s[1];(0,u.useEffect)(function(){var e=(0,l.io)(p.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:5000");return e.on("connect",function(){console.log("Connected to collaboration server"),b({type:"SET_CONNECTED",payload:!0}),e.emit("join_cosmic_collaboration",{user_id:localStorage.getItem("userId")||"anonymous"})}),e.on("disconnect",function(){console.log("Disconnected from collaboration server"),b({type:"SET_CONNECTED",payload:!1})}),e.on("user_position_update",function(e){b({type:"UPDATE_USER_POSITION",payload:{userId:e.user_id,name:e.username,position:e.position,rotation:e.rotation}})}),e.on("constellation_created",function(e){b({type:"ADD_CONSTELLATION",payload:e.constellation})}),e.on("collaboration_state",function(e){if(e.online_users){var t=new Map;e.online_users.forEach(function(e){t.set(e.user_id,{userId:e.user_id,name:"User ".concat(e.user_id.slice(-4)),position:[e.x||0,e.y||0,e.z||0],rotation:e.rotation||0})}),b({type:"SET_ONLINE_USERS",payload:t})}if(e.constellations){var n=new Map;e.constellations.forEach(function(e){n.set(e.id,e)}),e.constellations.forEach(function(e){b({type:"ADD_CONSTELLATION",payload:e})})}}),e.on("cosmic_collaboration_joined",function(e){console.log("Joined cosmic collaboration:",e)}),e.on("action_notification",function(e){b({type:"ADD_RECENT_ACTION",payload:{id:Date.now(),userId:e.user_id,username:e.username,action:e.action,actionType:e.action_type,timestamp:e.timestamp}})}),b({type:"SET_SOCKET",payload:e}),function(){return e.disconnect()}},[]);var x=(t=(0,r.A)(c().mark(function e(t){var n,r=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:0,f.currentUser){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,i.A.post("/api/v1/collaboration/position",{x:t[0],y:t[1],z:t[2],rotation:n},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),console.error("Failed to update position:",e.t0);case 11:case"end":return e.stop()}},e,null,[[3,8]])})),function(e){return t.apply(this,arguments)}),y=(n=(0,r.A)(c().mark(function e(t){var n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.A.post("/api/v1/constellations",t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 3:return n=e.sent,e.abrupt("return",n.data);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Failed to create constellation:",e.t0),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return n.apply(this,arguments)}),g=(o=(0,r.A)(c().mark(function e(t){var n,r,o=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"cosmos",e.prev=1,e.next=4,i.A.post("/api/v1/action",{action_type:t,room:n},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 4:return r=e.sent,e.abrupt("return",r.data);case 8:throw e.prev=8,e.t0=e.catch(1),console.error("Failed to trigger zodiac action:",e.t0),e.t0;case 12:case"end":return e.stop()}},e,null,[[1,8]])})),function(e){return o.apply(this,arguments)});return(0,d.jsx)(m.Provider,{value:h(h({},f),{},{updateUserPosition:x,createConstellation:y,triggerZodiacAction:g,getUsersInRoom:function(){return Array.from(f.onlineUsers.values())},getConstellations:function(){return Array.from(f.constellations.values())}}),children:a})},x=function(){var e=(0,u.useContext)(m);if(!e)throw Error("useCollaboration must be used within CollaborationProvider");return e}}}]);