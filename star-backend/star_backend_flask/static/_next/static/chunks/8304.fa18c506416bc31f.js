(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1161,3542,8304],{3542:(e,t,o)=>{"use strict";o.r(t),o.d(t,{AgoraUIKitLiveStream:()=>c});var r=o(7876),n=o(4563),a=o(4510),s=o(4141),i=o(4232),l=o(5364);function c(e){let{streamId:t,isHost:o=!1}=e,[c,u]=(0,i.useState)(null),[d,p]=(0,i.useState)(!0),[h,m]=(0,i.useState)(null),{socket:f,currentUser:y}=(0,n.T)();if((0,i.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await a.ND.auth.getSession();if(!e){m("Please log in to view live streams"),p(!1);return}let o=await fetch("".concat("https://star-backend.azurewebsites.net","/api/v1/live-stream/").concat(t),{headers:{Authorization:"Bearer ".concat(e.access_token)}});if(o.ok){let{stream:e}=await o.json();u(e)}else m("Stream not found or inactive")}catch(e){m("Failed to load stream"),console.error("Error fetching stream:",e)}finally{p(!1)}})()},[t]),(0,i.useEffect)(()=>{f&&c&&f.emit("join_stream",{streamId:c.id})},[f,c]),d)return(0,r.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,r.jsx)("div",{className:"text-white",children:"Loading stream..."})});if(h||!c)return(0,r.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,r.jsx)("div",{className:"text-red-400",children:h||"Stream not available"})});let g={appId:l.env.NEXT_PUBLIC_AGORA_APP_ID,channel:c.channel_name,token:c.agora_token};return(0,r.jsxs)("div",{className:"w-full h-full bg-black rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-r from-purple-900 to-blue-900",children:[(0,r.jsx)("h2",{className:"text-white text-xl font-bold",children:c.title}),(0,r.jsxs)("p",{className:"text-gray-300",children:["Hosted by ",c.username," (",c.zodiac_sign,")"]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(s.Ay,{rtcProps:g,callbacks:{EndCall:async()=>{if(o){let{data:{session:e}}=await a.ND.auth.getSession();e&&await fetch("".concat("https://star-backend.azurewebsites.net","/api/v1/live-stream/").concat(t,"/end"),{method:"POST",headers:{Authorization:"Bearer ".concat(e.access_token)}})}console.log("Call ended")}},styleProps:{UIKitContainer:{height:"600px",width:"100%"},localBtnContainer:{backgroundColor:"#1a1a1a"},localBtnStyles:{muteLocalAudio:{backgroundColor:"#4a5568"},muteLocalVideo:{backgroundColor:"#4a5568"},switchCamera:{backgroundColor:"#4a5568"},endCall:{backgroundColor:"#e53e3e"}}}}),(0,r.jsxs)("div",{className:"absolute top-4 left-4 bg-black/70 text-white p-3 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"LIVE"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-300 mt-1",children:"Cosmic Stream"})]})]})]})}},4510:(e,t,o)=>{"use strict";o.d(t,{ND:()=>r});let r=(0,o(6958).UU)("https://dummy.supabase.co","dummy_key")},4563:(e,t,o)=>{"use strict";o.d(t,{T:()=>h,p:()=>p});var r=o(7876),n=o(1040),a=o(5062),s=o.n(a),i=o(4232),l=o(2692),c=o(5364);let u=(0,i.createContext)(),d=(e,t)=>{switch(t.type){case"SET_ONLINE_USERS":return{...e,onlineUsers:new Map(t.payload)};case"UPDATE_USER_POSITION":let o=new Map(e.onlineUsers);return o.set(t.payload.userId,t.payload),{...e,onlineUsers:o};case"ADD_CONSTELLATION":let r=new Map(e.constellations);return r.set(t.payload.id,t.payload),{...e,constellations:r};case"SET_CURRENT_USER":return{...e,currentUser:t.payload};case"SET_SOCKET":return{...e,socket:t.payload};case"SET_CONNECTED":return{...e,isConnected:t.payload};case"ADD_RECENT_ACTION":return{...e,recentActions:[t.payload,...e.recentActions.slice(0,9)]};default:return e}},p=e=>{let{children:t}=e,[o,a]=(0,i.useReducer)(d,{onlineUsers:new Map,constellations:new Map,currentUser:null,socket:null,isConnected:!1,recentActions:[]});(0,i.useEffect)(()=>{let e=(0,l.io)(c.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:5000");return e.on("connect",()=>{console.log("Connected to collaboration server"),a({type:"SET_CONNECTED",payload:!0}),e.emit("join_cosmic_collaboration",{user_id:localStorage.getItem("userId")||"anonymous"})}),e.on("disconnect",()=>{console.log("Disconnected from collaboration server"),a({type:"SET_CONNECTED",payload:!1})}),e.on("user_position_update",e=>{a({type:"UPDATE_USER_POSITION",payload:{userId:e.user_id,name:e.username,position:e.position,rotation:e.rotation}})}),e.on("constellation_created",e=>{a({type:"ADD_CONSTELLATION",payload:e.constellation})}),e.on("collaboration_state",e=>{if(e.online_users){let t=new Map;e.online_users.forEach(e=>{t.set(e.user_id,{userId:e.user_id,name:"User ".concat(e.user_id.slice(-4)),position:[e.x||0,e.y||0,e.z||0],rotation:e.rotation||0})}),a({type:"SET_ONLINE_USERS",payload:t})}if(e.constellations){let t=new Map;e.constellations.forEach(e=>{t.set(e.id,e)}),e.constellations.forEach(e=>{a({type:"ADD_CONSTELLATION",payload:e})})}}),e.on("cosmic_collaboration_joined",e=>{console.log("Joined cosmic collaboration:",e)}),e.on("action_notification",e=>{a({type:"ADD_RECENT_ACTION",payload:{id:Date.now(),userId:e.user_id,username:e.username,action:e.action,actionType:e.action_type,timestamp:e.timestamp}})}),a({type:"SET_SOCKET",payload:e}),()=>e.disconnect()},[]);let s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(o.currentUser)try{await n.A.post("/api/v1/collaboration/position",{x:e[0],y:e[1],z:e[2],rotation:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})}catch(e){console.error("Failed to update position:",e)}},p=async e=>{try{return(await n.A.post("/api/v1/constellations",e,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data}catch(e){throw console.error("Failed to create constellation:",e),e}},h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cosmos";try{return(await n.A.post("/api/v1/action",{action_type:e,room:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data}catch(e){throw console.error("Failed to trigger zodiac action:",e),e}};return(0,r.jsx)(u.Provider,{value:{...o,updateUserPosition:s,createConstellation:p,triggerZodiacAction:h,getUsersInRoom:()=>Array.from(o.onlineUsers.values()),getConstellations:()=>Array.from(o.constellations.values())},children:t})};p.propTypes={children:s().node.isRequired};let h=()=>{let e=(0,i.useContext)(u);if(!e)throw Error("useCollaboration must be used within CollaborationProvider");return e}},5364:(e,t,o)=>{"use strict";var r,n;e.exports=(null==(r=o.g.process)?void 0:r.env)&&"object"==typeof(null==(n=o.g.process)?void 0:n.env)?o.g.process:o(5861)},5861:e=>{!function(){var t={229:function(e){var t,o,r,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(o){try{return t.call(null,e,0)}catch(o){return t.call(this,e,0)}}}var l=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?l=r.concat(l):u=-1,l.length&&p())}function p(){if(!c){var e=i(d);c=!0;for(var t=l.length;t;){for(r=l,l=[];++u<t;)r&&r[u].run();u=-1,t=l.length}r=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];l.push(new h(e,t)),1!==l.length||c||i(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},o={};function r(e){var n=o[e];if(void 0!==n)return n.exports;var a=o[e]={exports:{}},s=!0;try{t[e](a,a.exports,r),s=!1}finally{s&&delete o[e]}return a.exports}r.ab="//",e.exports=r(229)}()}}]);