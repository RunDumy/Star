"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[725],{725:(e,t,a)=>{a.r(t),a.d(t,{AgoraUIKitLiveStream:()=>h});var r=a(3857),s=a(3081),n=a.n(s),c=a(7534),l=a(5361),o=a(4141),i=a(4232),d=a(7876),u=a(5364);function h(e){var t,a=e.streamId,s=e.isHost,h=void 0!==s&&s,m=(0,i.useState)(null),x=m[0],f=m[1],p=(0,i.useState)(!0),v=p[0],b=p[1],g=(0,i.useState)(null),k=g[0],j=g[1],N=(0,c.T)(),w=N.socket;if(N.currentUser,(0,i.useEffect)(function(){var e;(e=(0,r.A)(n().mark(function e(){var t,r;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.N.auth.getSession();case 3:if(t=e.sent.data.session){e.next=9;break}return j("Please log in to view live streams"),b(!1),e.abrupt("return");case 9:return e.next=11,fetch("".concat("http://localhost:5000","/api/v1/live-stream/").concat(a),{headers:{Authorization:"Bearer ".concat(t.access_token)}});case 11:if(!(r=e.sent).ok){e.next=20;break}return e.next=15,r.json();case 15:f(e.sent.stream),e.next=21;break;case 20:j("Stream not found or inactive");case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),j("Failed to load stream"),console.error("Error fetching stream:",e.t0);case 27:return e.prev=27,b(!1),e.finish(27);case 30:case"end":return e.stop()}},e,null,[[0,23,27,30]])})),function(){return e.apply(this,arguments)})()},[a]),(0,i.useEffect)(function(){w&&x&&w.emit("join_stream",{streamId:x.id})},[w,x]),v)return(0,d.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,d.jsx)("div",{className:"text-white",children:"Loading stream..."})});if(k||!x)return(0,d.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,d.jsx)("div",{className:"text-red-400",children:k||"Stream not available"})});var C={appId:u.env.NEXT_PUBLIC_AGORA_APP_ID,channel:x.channel_name,token:x.agora_token},_={EndCall:(t=(0,r.A)(n().mark(function e(){var t;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!h){e.next=8;break}return e.next=3,l.N.auth.getSession();case 3:if(!(t=e.sent.data.session)){e.next=8;break}return e.next=8,fetch("".concat("http://localhost:5000","/api/v1/live-stream/").concat(a,"/end"),{method:"POST",headers:{Authorization:"Bearer ".concat(t.access_token)}});case 8:console.log("Call ended");case 9:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})};return(0,d.jsxs)("div",{className:"w-full h-full bg-black rounded-lg overflow-hidden",children:[(0,d.jsxs)("div",{className:"p-4 bg-gradient-to-r from-purple-900 to-blue-900",children:[(0,d.jsx)("h2",{className:"text-white text-xl font-bold",children:x.title}),(0,d.jsxs)("p",{className:"text-gray-300",children:["Hosted by ",x.username," (",x.zodiac_sign,")"]})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(o.Ay,{rtcProps:C,callbacks:_,styleProps:{UIKitContainer:{height:"600px",width:"100%"},localBtnContainer:{backgroundColor:"#1a1a1a"},localBtnStyles:{muteLocalAudio:{backgroundColor:"#4a5568"},muteLocalVideo:{backgroundColor:"#4a5568"},switchCamera:{backgroundColor:"#4a5568"},endCall:{backgroundColor:"#e53e3e"}}}}),(0,d.jsxs)("div",{className:"absolute top-4 left-4 bg-black/70 text-white p-3 rounded-lg",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,d.jsx)("span",{className:"text-sm font-medium",children:"LIVE"})]}),(0,d.jsx)("p",{className:"text-xs text-gray-300 mt-1",children:"Cosmic Stream"})]})]})]})}}}]);