(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4644],{252:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/feed",function(){return n(4822)}])},1320:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(4232);n(7876);var o=(0,r.createContext)({user:null,loading:!0,login:function(){},logout:function(){}}),s=function(){return(0,r.useContext)(o)}},4822:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>k}),n(2969);var r=n(3857),o=n(3081),s=n.n(o),a=n(4232),c=n(671),i=n(3420),l=n(4554),u=n(847),d=n(7876);function p(e){var t,n,r,o=e.isSparked,s=void 0!==o&&o,i=e.sparkCount,l=e.onSpark,u=e.size,p=void 0===u?"md":u,m=e.variant,h=(0,a.useState)(!1),f=h[0],x=h[1],v=(0,a.useState)({x:0,y:0}),b=v[0],g=v[1],y=(0,a.useRef)(null),N=(0,a.useRef)(null),j={sm:{button:"w-8 h-8",icon:"w-4 h-4",text:"text-sm"},md:{button:"w-10 h-10",icon:"w-5 h-5",text:"text-base"},lg:{button:"w-12 h-12",icon:"w-6 h-6",text:"text-lg"}},w=function(){if(N.current){var e=N.current;e.innerHTML="";for(var t=0;t<8;t++){var n=document.createElement("div");n.className="spark-particle";var r=t/8*Math.PI*2,o=30+20*Math.random(),s=Math.cos(r)*o,a=Math.sin(r)*o;n.style.setProperty("--particle-x","".concat(s,"px")),n.style.setProperty("--particle-y","".concat(a,"px")),n.style.setProperty("--particle-delay","".concat(.05*t,"s")),e.appendChild(n)}}};return(0,d.jsxs)("button",{ref:y,onClick:function(){f||(x(!0),l(),w(),setTimeout(function(){return x(!1)},1e3))},onMouseMove:function(e){if(y.current){var t=y.current.getBoundingClientRect();g({x:((e.clientX-t.left)/t.width-.5)*2,y:((e.clientY-t.top)/t.height-.5)*2})}},onMouseLeave:function(){g({x:0,y:0})},className:"\n        spark-button-3d relative ".concat(j[p].button," rounded-full\n        flex items-center justify-center transition-all duration-300\n        ").concat(s?"bg-gradient-to-r from-yellow-400 to-orange-500 shadow-yellow-400/50":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600","\n        shadow-lg hover:shadow-xl transform-gpu\n        ").concat(f?"spark-burst":"","\n        ").concat("cosmic"===(void 0===m?"cosmic":m)?"cosmic-spark-glow":"","\n        focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 focus:ring-offset-gray-900\n      "),style:(t=15*b.y,n=-15*b.x,r=f?1.2:1+.1*Math.abs(b.x+b.y),{transform:"rotateX(".concat(t,"deg) rotateY(").concat(n,"deg) scale(").concat(r,")")}),"aria-label":"".concat(s?"Unspark":"Spark"," this post"),"aria-pressed":!!s,children:[(0,d.jsx)("div",{ref:N,className:"absolute inset-0 pointer-events-none overflow-visible","aria-hidden":"true"}),(0,d.jsx)(c.A,{className:"\n          ".concat(j[p].icon," transition-all duration-300 text-white\n          ").concat(f?"spark-icon-pulse":"","\n        "),style:{filter:"drop-shadow(0 0 ".concat(f?"8px":"4px"," ").concat(s?"#fbbf24":"#a855f7",")")}}),(0,d.jsx)("span",{className:"\n          absolute -top-1 -right-1 ".concat(j[p].text," font-bold\n          ").concat(s?"text-yellow-300":"text-purple-300","\n          bg-gray-900 rounded-full px-1 min-w-[1.2em] text-center\n          border border-gray-700\n        "),children:i}),f&&(0,d.jsx)("div",{className:"absolute inset-0 rounded-full border-2 border-yellow-400 animate-ping","aria-hidden":"true"})]})}var m=n(236),h=n(7534),f=n(5361),x=n(5479),v=n(625),b=n(5364);function g(e){var t,n=e.postId,o=(0,v.Wx)(),c=o.ref,i=o.inView,l=(0,h.T)().socket,u=(0,a.useState)([]),p=u[0],g=u[1],y=(t=(0,r.A)(s().mark(function e(t){var r,o,a,c;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0===(r=t.pageParam)?1:r,e.next=3,f.N.auth.getSession();case 3:return a=e.sent.data.session,e.next=7,fetch("".concat(b.env.VITE_API_URL,"/api/v1/comments/").concat(n,"?page=").concat(o),{headers:{Authorization:"Bearer ".concat(a.access_token)}});case 7:if((c=e.sent).ok){e.next=10;break}throw Error("Failed to fetch comments");case 10:return e.next=12,c.json();case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),N=(0,x.q)({queryKey:["comments",n],queryFn:y,initialPageParam:1,getNextPageParam:function(e,t){if(!(e.comments.length<20))return t.length+1}}),j=N.data,w=N.fetchNextPage,_=N.hasNextPage,k=N.isFetchingNextPage,E=N.status;return((0,a.useEffect)(function(){i&&_&&!k&&w()},[i,_,w]),(0,a.useEffect)(function(){return l.emit("join_post",{post_id:n}),l.on("new_comment",function(e){e.post_id===n&&g(function(t){return[e].concat((0,m.A)(t))})}),function(){l.off("new_comment")}},[l,n]),(0,a.useEffect)(function(){var e=f.N.channel("comments:".concat(n)).on("postgres_changes",{event:"INSERT",schema:"public",table:"comment",filter:"post_id=eq.".concat(n)},function(e){g(function(t){return[e.new].concat((0,m.A)(t))})}).subscribe();return function(){return f.N.removeChannel(e)}},[n]),"loading"===E)?(0,d.jsx)("div",{className:"text-cyan-200",children:"Loading comments..."}):"error"===E?(0,d.jsx)("div",{className:"text-red-400",children:"Error loading comments!"}):(0,d.jsxs)("div",{className:"space-y-4",children:[p.concat((null==j?void 0:j.pages.flatMap(function(e){return e.comments}))||[]).map(function(e,t){var n;return(0,d.jsxs)("div",{className:"cosmic-post-3d cosmic-glow rounded-lg border border-cyan-500/30 p-4 bg-gradient-to-br from-cyan-900/30 to-blue-900/20 backdrop-blur-lg depth-3",style:{transform:"translateZ(".concat(10+5*t,"px)")},children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,d.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:(null==(n=e.username)||null==(n=n.charAt(0))?void 0:n.toUpperCase())||"A"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-white font-semibold",children:e.username||"Cosmic Traveler"}),(0,d.jsx)("div",{className:"text-gray-400 text-xs",children:e.zodiac_sign})]})]}),(0,d.jsx)("p",{className:"text-white",children:e.content}),(0,d.jsx)("div",{className:"text-gray-400 text-xs mt-2",children:new Date(e.created_at).toLocaleDateString()})]},"".concat(e.id,"-").concat(t))}),(0,d.jsxs)("div",{ref:c,className:"text-center",children:[k&&(0,d.jsx)("div",{className:"text-cyan-200",children:"Loading more comments..."}),!_&&(0,d.jsx)("div",{className:"text-gray-500",children:"No more comments to load."})]})]})}function y(e){var t,n,r,o,s=e.post,m=e.index,h=(0,a.useState)(!1),f=h[0],x=h[1],v=(0,a.useState)(!1),b=v[0],y=v[1],N=(0,a.useState)({x:0,y:0}),j=N[0],w=N[1],_=(0,a.useRef)(null);return(0,d.jsxs)("article",{ref:_,className:"\n        cosmic-post-3d cosmic-glow rounded-2xl border border-purple-500/30 p-6 shadow-2xl\n        bg-gradient-to-br from-purple-900/30 to-blue-900/20 backdrop-blur-lg\n        ".concat((t=["cosmic-float-3d","cosmic-float-3d-reverse","cosmic-float-3d-slow"])[m%t.length],"\n      "),style:(n=10*j.y,r=-10*j.x,o=20*Math.abs(j.x+j.y),{"--mouse-rotate-x":"".concat(n,"deg"),"--mouse-rotate-y":"".concat(r,"deg"),"--mouse-translate-z":"".concat(o,"px")}),onMouseMove:function(e){if(_.current){var t=_.current.getBoundingClientRect();w({x:((e.clientX-t.left)/t.width-.5)*2,y:((e.clientY-t.top)/t.height-.5)*2})}},onMouseLeave:function(){w({x:0,y:0})},children:[(0,d.jsxs)("header",{className:"flex items-center justify-between mb-4 depth-1",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold cosmic-pulse depth-3",style:{"--depth-mouse-z":"".concat(5*j.x,"px")},children:s.username.charAt(0).toUpperCase()}),(0,d.jsxs)("div",{className:"depth-2",children:[(0,d.jsx)("div",{className:"text-white font-semibold",children:s.username}),(0,d.jsx)("div",{className:"text-purple-300 text-sm",children:s.zodiac_sign})]})]}),(0,d.jsx)("time",{className:"text-gray-400 text-sm depth-1",children:new Date(s.created_at).toLocaleDateString()})]}),(0,d.jsx)("button",{className:"text-white mb-4 transition-all duration-300 depth-2 text-left ".concat(b?"":"line-clamp-3"),onClick:function(){return y(!b)},onKeyDown:function(e){("Enter"===e.key||" "===e.key)&&(e.preventDefault(),y(!b))},style:{"--depth-mouse-z":"".concat(5*Math.abs(j.y),"px")},"aria-expanded":b,children:s.content}),s.image_url&&(0,d.jsx)("figure",{className:"mb-4 rounded-xl overflow-hidden border border-purple-500/30 depth-3",style:{"--depth-mouse-z":"".concat(10*Math.abs(j.x),"px")},children:(0,d.jsx)("img",{src:s.image_url,alt:"Post media",className:"w-full h-auto max-h-96 object-cover transition-transform duration-700 hover:scale-110"})}),s.video_url&&(0,d.jsx)("figure",{className:"mb-4 rounded-xl overflow-hidden border border-purple-500/30 depth-3",style:{"--depth-mouse-z":"".concat(10*Math.abs(j.x),"px")},children:(0,d.jsx)(u.Ay,{height:384,offset:100,children:s.hls_url||s.video_url?(0,d.jsx)("video",{src:s.hls_url||s.video_url,controls:!0,className:"w-full h-auto max-h-96 object-cover"}):s.image_url?(0,d.jsx)("img",{src:s.image_url,alt:s.content,className:"w-full h-auto max-h-96 object-cover"}):null})}),(0,d.jsx)("div",{className:"flex justify-between items-center text-sm text-gray-400 mb-4 depth-1",style:{"--depth-mouse-z":"".concat(3*Math.abs(j.y),"px")},children:(0,d.jsxs)("div",{className:"flex space-x-4",children:[(0,d.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,d.jsx)(c.A,{className:"w-4 h-4"}),(0,d.jsx)("span",{children:s.spark_count})]}),(0,d.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,d.jsx)(i.A,{className:"w-4 h-4"}),(0,d.jsx)("span",{children:s.echo_count})]}),(0,d.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,d.jsx)(l.A,{className:"w-4 h-4"}),(0,d.jsx)("span",{children:s.comment_count})]})]})}),(0,d.jsxs)("div",{className:"flex space-x-4 border-t border-purple-500/20 pt-4 depth-2",style:{"--depth-mouse-z":"".concat(4*Math.abs(j.x),"px")},children:[(0,d.jsx)(p,{isSparked:!1,sparkCount:s.spark_count,onSpark:function(){return console.log("Spark clicked")},size:"md",variant:"cosmic"}),(0,d.jsxs)("button",{onClick:function(){return x(!f)},className:"flex items-center space-x-2 text-gray-400 hover:text-purple-400 transition-colors transform hover:scale-110 hover:translateZ(10px)","aria-label":"Toggle comments","aria-expanded":!!f,children:[(0,d.jsx)(l.A,{className:"w-5 h-5"}),(0,d.jsx)("span",{children:"Comment"})]}),(0,d.jsxs)("button",{className:"flex items-center space-x-2 text-gray-400 hover:text-green-400 transition-colors transform hover:scale-110 hover:translateZ(10px)","aria-label":"Echo this post",children:[(0,d.jsx)(i.A,{className:"w-5 h-5"}),(0,d.jsx)("span",{children:"Echo"})]})]}),f&&(0,d.jsx)("section",{className:"mt-4 border-t border-purple-500/20 pt-4 depth-4",style:{"--depth-mouse-z":"0px"},children:(0,d.jsx)(g,{postId:s.id.toString()})})]})}function N(e){var t=e.posts,n=(0,a.useState)(0),r=n[0],o=n[1],s=(0,a.useRef)(null);return(0,a.useEffect)(function(){var e=function(){o(window.scrollY)};return window.addEventListener("scroll",e,{passive:!0}),function(){return window.removeEventListener("scroll",e)}},[]),(0,d.jsxs)("div",{ref:s,className:"cosmic-feed-3d relative min-h-screen",style:{"--scroll-y":"".concat(r,"px")},children:[(0,d.jsxs)("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[(0,d.jsx)("div",{className:"cosmic-particle particle-1"}),(0,d.jsx)("div",{className:"cosmic-particle particle-2"}),(0,d.jsx)("div",{className:"cosmic-particle particle-3"}),(0,d.jsx)("div",{className:"cosmic-nebula nebula-1"}),(0,d.jsx)("div",{className:"cosmic-nebula nebula-2"})]}),(0,d.jsxs)("div",{className:"relative z-10 max-w-2xl mx-auto px-4 py-8 space-y-8",children:[(0,d.jsxs)("header",{className:"text-center mb-12 cosmic-feed-header",children:[(0,d.jsx)("h1",{className:"text-4xl font-bold text-white mb-4 cosmic-glow",children:"Cosmic Feed"}),(0,d.jsx)("p",{className:"text-purple-300 text-lg",children:"Explore the depths of shared consciousness"})]}),(0,d.jsx)("div",{className:"space-y-8",children:t.map(function(e,t){return(0,d.jsx)("div",{className:"cosmic-post-wrapper",style:{"--stagger-delay":"".concat(.1*t,"s"),"--scroll-offset":"".concat(.1*r,"px")},children:(0,d.jsx)(y,{post:e,index:t})},e.id)})}),t.length>0&&(0,d.jsx)("div",{className:"text-center py-12",children:(0,d.jsx)("div",{className:"cosmic-load-more text-purple-400 hover:text-purple-300 transition-colors cursor-pointer",children:(0,d.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,d.jsx)("div",{className:"cosmic-spinner"}),(0,d.jsx)("span",{children:"Load more cosmic posts..."})]})})}),0===t.length&&(0,d.jsx)("div",{className:"text-center py-20",children:(0,d.jsx)("div",{className:"cosmic-empty-state text-gray-400 text-xl",children:"No posts yet. Be the first to share your cosmic thoughts!"})})]})]})}var j=n(1320),w=n(8230),_=n.n(w);function k(){var e,t=(0,j.A)().user,n=(0,a.useState)([]),o=n[0],c=n[1],i=(0,a.useState)(""),l=i[0],u=i[1],p=(0,a.useState)(""),m=p[0],h=p[1],f=(0,a.useState)({});f[0],f[1];var x=(0,a.useState)(!0),v=x[0],b=x[1],g=(0,a.useState)(""),y=g[0],w=g[1];(0,a.useEffect)(function(){if(t){var e;return(e=(0,r.A)(s().mark(function e(){var n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat("http://localhost:5000","/api/v1/posts"),{headers:{Authorization:"Bearer ".concat(t.id)}});case 3:return n=e.sent,e.next=6,n.json();case 6:(r=e.sent).posts&&c(r.posts),b(!1),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),w("Failed to load posts"),b(!1);case 15:case"end":return e.stop()}},e,null,[[0,11]])})),function(){return e.apply(this,arguments)})(),function(){}}},[t]);var k=(e=(0,r.A)(s().mark(function e(){var n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.trim()){e.next=3;break}return w("Post content is required"),e.abrupt("return");case 3:return e.prev=3,e.next=6,fetch("".concat("http://localhost:5000","/api/v1/posts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((null==t?void 0:t.id)||"")},body:JSON.stringify({content:l,media_url:m||void 0})});case 6:return n=e.sent,e.next=9,n.json();case 9:(r=e.sent).success?(u(""),h(""),w("")):w(r.error||"Failed to create post"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),w("Network error");case 16:case"end":return e.stop()}},e,null,[[3,13]])})),function(){return e.apply(this,arguments)});return t?v?(0,d.jsx)("p",{className:"text-white p-4",children:"Loading cosmic feed..."}):y?(0,d.jsx)("p",{className:"text-red-500 p-4",children:y}):(0,d.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[(0,d.jsx)(_(),{href:"/home",className:"text-blue-400 hover:underline mb-4 inline-block p-4",children:"Back to Cosmic Home"}),(0,d.jsxs)("div",{className:"max-w-2xl mx-auto mb-8 p-6 bg-gray-800/50 backdrop-blur-lg rounded-2xl border border-purple-500/30",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Share Your Cosmic Thoughts"}),(0,d.jsx)("textarea",{value:l,onChange:function(e){return u(e.target.value)},placeholder:"Share your cosmic thoughts...",className:"w-full p-3 rounded-lg bg-gray-900/50 text-white mb-3 border border-purple-500/30 focus:border-purple-400 focus:outline-none",rows:4}),(0,d.jsx)("input",{type:"text",value:m,onChange:function(e){return h(e.target.value)},placeholder:"Optional Spotify track URL (e.g., https://open.spotify.com/track/xyz)",className:"w-full p-3 rounded-lg bg-gray-900/50 text-white mb-3 border border-purple-500/30 focus:border-purple-400 focus:outline-none"}),(0,d.jsx)("button",{onClick:k,className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105",children:"Post to the Cosmos"})]}),(0,d.jsx)(N,{posts:o.map(function(e){return{id:e.id,content:e.content,username:e.profiles.display_name,zodiac_sign:e.zodiac_sign,image_url:e.media_url,spark_count:e.like_count,echo_count:0,comment_count:e.comments.length,created_at:e.created_at}})})]}):(0,d.jsxs)("div",{className:"min-h-screen bg-black text-white p-4",children:[(0,d.jsx)("h1",{className:"text-3xl",children:"Please Log In"}),(0,d.jsx)("p",{children:"Access the cosmic feed after signing in."})]})}},5361:(e,t,n)=>{"use strict";n.d(t,{N:()=>a});var r=n(3857),o=n(3081),s=n.n(o),a={auth:{getUser:function(){return(0,r.A)(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:{user:null}});case 1:case"end":return e.stop()}},e)}))()},signOut:function(){return(0,r.A)(s().mark(function e(){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)}))()},onAuthStateChange:function(e){return{data:{subscription:null},unsubscribe:function(){}}}},from:function(e){return{select:function(e){return{eq:function(e,t){return{single:function(){return Promise.resolve({data:null,error:null})}}}}},insert:function(e){return Promise.resolve({data:null,error:null})},update:function(e){return{eq:function(e,t){return Promise.resolve({data:null,error:null})}}},delete:function(){return{eq:function(e,t){return Promise.resolve({data:null,error:null})}}}}},channel:function(e){return{on:function(e,t){return this},subscribe:function(e){return e&&e(),this},unsubscribe:function(){return Promise.resolve()}}},removeChannel:function(e){return Promise.resolve()}}},7534:(e,t,n)=>{"use strict";n.d(t,{T:()=>b,p:()=>v});var r=n(3857),o=n(236),s=n(2969),a=n(3081),c=n.n(a),i=n(1040),l=n(4232),u=n(2692),d=n(7876),p=n(5364);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,s.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var f=(0,l.createContext)(),x=function(e,t){switch(t.type){case"SET_ONLINE_USERS":return h(h({},e),{},{onlineUsers:new Map(t.payload)});case"UPDATE_USER_POSITION":var n=new Map(e.onlineUsers);return n.set(t.payload.userId,t.payload),h(h({},e),{},{onlineUsers:n});case"ADD_CONSTELLATION":var r=new Map(e.constellations);return r.set(t.payload.id,t.payload),h(h({},e),{},{constellations:r});case"SET_CURRENT_USER":return h(h({},e),{},{currentUser:t.payload});case"SET_SOCKET":return h(h({},e),{},{socket:t.payload});case"SET_CONNECTED":return h(h({},e),{},{isConnected:t.payload});case"ADD_RECENT_ACTION":return h(h({},e),{},{recentActions:[t.payload].concat((0,o.A)(e.recentActions.slice(0,9)))});default:return e}},v=function(e){var t,n,o,s=e.children,a=(0,l.useReducer)(x,{onlineUsers:new Map,constellations:new Map,currentUser:null,socket:null,isConnected:!1,recentActions:[]}),m=a[0],v=a[1];(0,l.useEffect)(function(){var e=(0,u.io)(p.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:5000");return e.on("connect",function(){console.log("Connected to collaboration server"),v({type:"SET_CONNECTED",payload:!0}),e.emit("join_cosmic_collaboration",{user_id:localStorage.getItem("userId")||"anonymous"})}),e.on("disconnect",function(){console.log("Disconnected from collaboration server"),v({type:"SET_CONNECTED",payload:!1})}),e.on("user_position_update",function(e){v({type:"UPDATE_USER_POSITION",payload:{userId:e.user_id,name:e.username,position:e.position,rotation:e.rotation}})}),e.on("constellation_created",function(e){v({type:"ADD_CONSTELLATION",payload:e.constellation})}),e.on("collaboration_state",function(e){if(e.online_users){var t=new Map;e.online_users.forEach(function(e){t.set(e.user_id,{userId:e.user_id,name:"User ".concat(e.user_id.slice(-4)),position:[e.x||0,e.y||0,e.z||0],rotation:e.rotation||0})}),v({type:"SET_ONLINE_USERS",payload:t})}if(e.constellations){var n=new Map;e.constellations.forEach(function(e){n.set(e.id,e)}),e.constellations.forEach(function(e){v({type:"ADD_CONSTELLATION",payload:e})})}}),e.on("cosmic_collaboration_joined",function(e){console.log("Joined cosmic collaboration:",e)}),e.on("action_notification",function(e){v({type:"ADD_RECENT_ACTION",payload:{id:Date.now(),userId:e.user_id,username:e.username,action:e.action,actionType:e.action_type,timestamp:e.timestamp}})}),v({type:"SET_SOCKET",payload:e}),function(){return e.disconnect()}},[]);var b=(t=(0,r.A)(c().mark(function e(t){var n,r=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:0,m.currentUser){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,i.A.post("/api/v1/collaboration/position",{x:t[0],y:t[1],z:t[2],rotation:n},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),console.error("Failed to update position:",e.t0);case 11:case"end":return e.stop()}},e,null,[[3,8]])})),function(e){return t.apply(this,arguments)}),g=(n=(0,r.A)(c().mark(function e(t){var n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.A.post("/api/v1/constellations",t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 3:return n=e.sent,e.abrupt("return",n.data);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Failed to create constellation:",e.t0),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return n.apply(this,arguments)}),y=(o=(0,r.A)(c().mark(function e(t){var n,r,o=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"cosmos",e.prev=1,e.next=4,i.A.post("/api/v1/action",{action_type:t,room:n},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 4:return r=e.sent,e.abrupt("return",r.data);case 8:throw e.prev=8,e.t0=e.catch(1),console.error("Failed to trigger zodiac action:",e.t0),e.t0;case 12:case"end":return e.stop()}},e,null,[[1,8]])})),function(e){return o.apply(this,arguments)});return(0,d.jsx)(f.Provider,{value:h(h({},m),{},{updateUserPosition:b,createConstellation:g,triggerZodiacAction:y,getUsersInRoom:function(){return Array.from(m.onlineUsers.values())},getConstellations:function(){return Array.from(m.constellations.values())}}),children:s})},b=function(){var e=(0,l.useContext)(f);if(!e)throw Error("useCollaboration must be used within CollaborationProvider");return e}}},e=>{e.O(0,[1040,8230,1927,7268,636,6593,8792],()=>e(e.s=252)),_N_E=e.O()}]);