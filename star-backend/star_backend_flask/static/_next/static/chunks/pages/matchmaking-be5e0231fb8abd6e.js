(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2228],{4508:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/matchmaking",function(){return a(5304)}])},4510:(e,t,a)=>{"use strict";a.d(t,{ND:()=>s});let s=(0,a(6958).UU)("https://dummy.supabase.co","dummy_key")},4614:(e,t,a)=>{"use strict";a.d(t,{FH:()=>c,aS:()=>u,d$:()=>d,JB:()=>r,U4:()=>h,pG:()=>m,iD:()=>o,jc:()=>p,tt:()=>l});var s=a(1040);function i(e){let t={...e};if("string"==typeof t.user_id){let e=parseInt(t.user_id,10);Number.isNaN(e)||(t.user_id=e)}return t}let n="https://star-backend.azurewebsites.net".replace(/\/$/,""),c=s.A.create({baseURL:n});async function o(e){return(await c.post("/api/v1/login",e)).data}async function r(){return(await c.get("/api/v1/zodiac-numbers")).data}async function l(e){return(await c.post("/api/v1/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,a={page:e};return void 0!==t&&(a.user_id=t),(await c.get("/api/v1/feed",{params:a})).data}async function u(e){return(await c.post("/api/v1/archetype-oracle/calculate",e)).data}async function p(e,t,a){return"undefined"!=typeof fetch?(await fetch("/api/v1/tarot/share-spread",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spread:e,spread_type:t,user_id:a})})).json():(await c.post("/api/v1/tarot/share-spread",{spread:e,spread_type:t,user_id:a})).data}async function h(e,t){return"undefined"!=typeof fetch?(await fetch("/api/v1/tarot/spotify-playlist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({energy_flows:e,spread_type:t})})).json():(await c.post("/api/v1/tarot/spotify-playlist",{energy_flows:e,spread_type:t})).data}async function m(e){return"undefined"!=typeof fetch?(await fetch("/api/v1/tarot/location-insights",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip_address:e})})).json():(await c.post("/api/v1/tarot/location-insights",{ip_address:e})).data}c.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(t))}return e}),c.interceptors.response.use(e=>{var t;return(null==(t=e.config.url)?void 0:t.includes("/api/v1/feed"))&&(e.data=function(e){return{...e,items:e.items.map(i)}}(e.data)),e})},5304:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(7876),i=a(5784),n=a(6848),c=a(4232),o=a(4614),r=a(4e3),l=a(4510);function d(e){let{children:t}=e,a=(0,r.useRouter)(),[i,n]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{let e=!0;return(async()=>{try{let{data:{user:t}}=await l.ND.auth.getUser();!t&&e&&a.push("/login")}catch(e){a.push("/login")}finally{e&&n(!1)}})(),()=>{e=!1}},[a]),i)?(0,s.jsx)("div",{className:"p-6",children:"Checking authentication..."}):(0,s.jsx)(s.Fragment,{children:t})}let u=e=>{let{cardName:t}=e;return(0,s.jsx)("div",{style:{width:"200px",height:"300px",background:"#4B0082",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:t})};function p(){let[e,t]=(0,c.useState)([]),[a,r]=(0,c.useState)({sent:[],received:[]}),[l,d]=(0,c.useState)(!1),[p,h]=(0,c.useState)(""),[m,x]=(0,c.useState)("suggestions"),[g,y]=(0,c.useState)(!1),[j,b]=(0,c.useState)(null),[f,v]=(0,c.useState)(null),[N,w]=(0,c.useState)(!1),[_,C]=(0,c.useState)(null),k=(0,c.useCallback)(async()=>{d(!0);try{let e=p?"?zodiac=".concat(encodeURIComponent(p)):"",a=await o.FH.get("/api/v1/matchmaking/suggestions"+e);t(a.data.suggestions||[])}catch(e){console.error("Failed to load suggestions",e)}finally{d(!1)}},[p]);async function S(){try{let e=await o.FH.get("/api/v1/mood");C(e.data)}catch(e){console.error("Failed to load user mood",e)}}async function F(){try{let e=await o.FH.get("/api/v1/matchmaking/connections");r(e.data||{sent:[],received:[]})}catch(e){console.error("Failed to load connections",e)}}async function P(e,t){try{await o.FH.post("/api/v1/matchmaking/connection",{action:e,connection_id:t}),y(!1),b(null),F()}catch(e){console.error("Failed to respond to connection",e),alert("Failed to respond to connection")}}async function H(e){try{let t=await o.FH.post("/api/v1/matchmaking/connection",{target_id:e});alert(t.data.message||"Request sent"),F()}catch(e){console.error("Failed to send request",e),alert("Failed to send request")}}async function z(e){try{await o.FH.post("/api/v1/matchmaking/connection",{target_id:e,action:"request"});let t=((await o.FH.get("/api/v1/matchmaking/connections")).data.sent||[]).find(t=>t.other_id===e);t&&await o.FH.post("/api/v1/matchmaking/connection",{action:"reject",connection_id:t.id}),F()}catch(e){console.error("Failed to reject suggestion",e)}}(0,c.useEffect)(()=>{k(),F(),S()},[k]);let T=async()=>{d(!0);try{let e=await o.FH.post("/api/v1/tarot/pull");e.data.success?(v(e.data.card),w(!0),k()):alert(e.data.error||"Failed to draw a cosmic card")}catch(e){console.error("Unable to connect to the cosmos",e),alert("Unable to connect to the cosmos")}finally{d(!1)}};return(0,s.jsxs)("div",{className:"p-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Matchmaking"}),_&&(0,s.jsxs)("div",{className:"mb-4 p-4 bg-gray-800 rounded-lg",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Your Current Mood"}),(0,s.jsxs)("p",{className:"text-gray-300",children:["Mood: ",_.mood," (Intensity: ",_.intensity.toFixed(2),")"]})]}),(0,s.jsxs)("div",{className:"mb-6 flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>x("suggestions"),className:"px-3 py-2 rounded ".concat("suggestions"===m?"bg-purple-600":"bg-gray-700"),children:"Suggestions"}),(0,s.jsx)("button",{onClick:()=>x("connections"),className:"px-3 py-2 rounded ".concat("connections"===m?"bg-purple-600":"bg-gray-700"),children:"Connections"}),(0,s.jsx)("button",{onClick:()=>x("horoscopes"),className:"px-3 py-2 rounded ".concat("horoscopes"===m?"bg-purple-600":"bg-gray-700"),children:"Horoscopes"})]}),(0,s.jsxs)(i.N,{mode:"wait",children:["suggestions"===m&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Suggestions"}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[(0,s.jsx)("label",{htmlFor:"zodiac-filter",className:"text-sm",children:"Filter by zodiac:"}),(0,s.jsxs)("select",{id:"zodiac-filter",value:p,onChange:e=>h(e.target.value),className:"bg-gray-700 p-2 rounded text-sm",children:[(0,s.jsx)("option",{value:"",children:"All"}),["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsx)("button",{className:"ml-2 px-3 py-1 bg-indigo-600 rounded",onClick:()=>k(),children:"Apply"})]}),(0,s.jsx)("div",{className:"mt-4 flex justify-center",children:(0,s.jsx)("button",{onClick:T,className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-all duration-300",disabled:l,children:l?"Drawing...":"Draw Your Cosmic Card"})}),l&&(0,s.jsx)("p",{children:"Loading..."}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",children:e.map(e=>(0,s.jsxs)(n.P.div,{layout:!0,className:"p-4 rounded bg-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-white font-medium",children:e.username}),(0,s.jsx)("div",{className:"text-gray-400 text-sm",children:e.zodiac_sign})]}),(0,s.jsx)("div",{className:"text-sm text-yellow-300",children:e.compatibility_score?"".concat(e.compatibility_score,"%"):"—"})]}),e.bio&&(0,s.jsx)("div",{className:"text-gray-300 text-sm mt-2",children:e.bio}),(0,s.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,s.jsx)("button",{className:"px-3 py-1 bg-indigo-600 rounded",onClick:()=>H(e.id),disabled:e.has_connection,children:"Connect"}),(0,s.jsx)("button",{className:"px-3 py-1 bg-red-600 rounded",onClick:()=>z(e.id),children:"Reject"})]})]},e.id))})]},"suggestions"),"connections"===m&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Connections"}),(0,s.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg",children:"Sent"}),(0,s.jsx)("ul",{children:a.sent.map(e=>(0,s.jsxs)("li",{className:"py-2 border-b border-gray-700",children:[e.other_username," — ",e.status]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg",children:"Received"}),(0,s.jsx)("ul",{children:a.received.map(e=>(0,s.jsxs)("li",{className:"py-2 border-b border-gray-700 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[e.other_username," — ",e.status]}),"pending"===e.status&&(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("button",{onClick:()=>{b(e),y(!0)},className:"px-3 py-1 bg-green-600 rounded",children:"Respond"})})]},e.id))})]})]})]},"connections"),"horoscopes"===m&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Pair Horoscopes"}),(0,s.jsx)("div",{className:"mt-4 text-gray-300",children:"When two connections are accepted their pair horoscope appears here. (Coming soon)"})]},"horoscopes")]}),(0,s.jsx)(i.N,{children:g&&j&&(0,s.jsx)(n.P.div,{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsxs)(n.P.div,{className:"bg-navy-900 p-6 rounded-lg w-11/12 max-w-md",initial:{scale:.95},animate:{scale:1},exit:{scale:.95},children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Connection Request"}),(0,s.jsxs)("p",{className:"text-gray-300 mb-4",children:[j.other_username," has sent you a connection request."]}),(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)("button",{onClick:()=>{P("reject",j.id)},className:"px-3 py-2 bg-red-600 rounded",children:"Reject"}),(0,s.jsx)("button",{onClick:()=>{P("accept",j.id)},className:"px-3 py-2 bg-green-600 rounded",children:"Accept"})]})]})})}),N&&f&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"Your Cosmic Guidance"}),(0,s.jsx)("div",{className:"flex justify-center mb-4",children:(0,s.jsx)(u,{cardName:f.card_name})}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:f.card_name}),(0,s.jsx)("p",{className:"text-gray-700 mb-4",children:f.interpretation}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("button",{onClick:()=>w(!1),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600",children:"Close"}),(0,s.jsx)("button",{onClick:()=>{var e,t;null==(e=(t=navigator).share)||e.call(t,{title:"My Cosmic Card: ".concat(f.card_name),text:f.interpretation})},className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Share"})]})]})})]})}function h(){return(0,s.jsx)(d,{children:(0,s.jsx)(p,{})})}function m(){return(0,s.jsx)(h,{})}}},e=>{e.O(0,[2909,1040,6958,6848,5508,636,6593,8792],()=>e(e.s=4508)),_N_E=e.O()}]);