(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4644],{252:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/feed",function(){return s(3768)}])},3768:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>_});var a=s(7876),o=s(4232),r=s(3884),n=s(665),c=s(3381),l=s(847);function i(e){let{isSparked:t=!1,sparkCount:s,onSpark:n,size:c="md",variant:l="cosmic"}=e,[i,d]=(0,o.useState)(!1),[u,p]=(0,o.useState)({x:0,y:0}),m=(0,o.useRef)(null),h=(0,o.useRef)(null),x={sm:{button:"w-8 h-8",icon:"w-4 h-4",text:"text-sm"},md:{button:"w-10 h-10",icon:"w-5 h-5",text:"text-base"},lg:{button:"w-12 h-12",icon:"w-6 h-6",text:"text-lg"}};return(0,a.jsxs)("button",{ref:m,onClick:()=>{i||(d(!0),n(),(()=>{if(!h.current)return;let e=h.current;e.innerHTML="";for(let t=0;t<8;t++){let s=document.createElement("div");s.className="spark-particle";let a=t/8*Math.PI*2,o=30+20*Math.random(),r=Math.cos(a)*o,n=Math.sin(a)*o;s.style.setProperty("--particle-x","".concat(r,"px")),s.style.setProperty("--particle-y","".concat(n,"px")),s.style.setProperty("--particle-delay","".concat(.05*t,"s")),e.appendChild(s)}})(),setTimeout(()=>d(!1),1e3))},onMouseMove:e=>{if(!m.current)return;let t=m.current.getBoundingClientRect();p({x:((e.clientX-t.left)/t.width-.5)*2,y:((e.clientY-t.top)/t.height-.5)*2})},onMouseLeave:()=>{p({x:0,y:0})},className:"\n        spark-button-3d relative ".concat(x[c].button," rounded-full\n        flex items-center justify-center transition-all duration-300\n        ").concat(t?"bg-gradient-to-r from-yellow-400 to-orange-500 shadow-yellow-400/50":"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600","\n        shadow-lg hover:shadow-xl transform-gpu\n        ").concat(i?"spark-burst":"","\n        ").concat("cosmic"===l?"cosmic-spark-glow":"","\n        focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 focus:ring-offset-gray-900\n      "),style:(()=>{let e=15*u.y,t=-15*u.x,s=i?1.2:1+.1*Math.abs(u.x+u.y);return{transform:"rotateX(".concat(e,"deg) rotateY(").concat(t,"deg) scale(").concat(s,")")}})(),"aria-label":"".concat(t?"Unspark":"Spark"," this post"),"aria-pressed":!!t,children:[(0,a.jsx)("div",{ref:h,className:"absolute inset-0 pointer-events-none overflow-visible","aria-hidden":"true"}),(0,a.jsx)(r.A,{className:"\n          ".concat(x[c].icon," transition-all duration-300 text-white\n          ").concat(i?"spark-icon-pulse":"","\n        "),style:{filter:"drop-shadow(0 0 ".concat(i?"8px":"4px"," ").concat(t?"#fbbf24":"#a855f7",")")}}),(0,a.jsx)("span",{className:"\n          absolute -top-1 -right-1 ".concat(x[c].text," font-bold\n          ").concat(t?"text-yellow-300":"text-purple-300","\n          bg-gray-900 rounded-full px-1 min-w-[1.2em] text-center\n          border border-gray-700\n        "),children:s}),i&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-2 border-yellow-400 animate-ping","aria-hidden":"true"})]})}var d=s(4563),u=s(4510),p=s(5479),m=s(5062),h=s.n(m),x=s(625),f=s(5364);function g(e){let{postId:t}=e,{ref:s,inView:r}=(0,x.Wx)(),{socket:n}=(0,d.T)(),[c,l]=(0,o.useState)([]),i=async e=>{let{pageParam:s=1}=e,{data:{session:a}}=await u.ND.auth.getSession(),o=await fetch("".concat(f.env.VITE_API_URL,"/api/v1/comments/").concat(t,"?page=").concat(s),{headers:{Authorization:"Bearer ".concat(a.access_token)}});if(!o.ok)throw Error("Failed to fetch comments");return await o.json()},{data:m,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:y,status:b}=(0,p.q)({queryKey:["comments",t],queryFn:i,initialPageParam:1,getNextPageParam:(e,t)=>{if(!(e.comments.length<20))return t.length+1}});return((0,o.useEffect)(()=>{r&&g&&!y&&h()},[r,g,h]),(0,o.useEffect)(()=>(n.emit("join_post",{post_id:t}),n.on("new_comment",e=>{e.post_id===t&&l(t=>[e,...t])}),()=>{n.off("new_comment")}),[n,t]),(0,o.useEffect)(()=>{let e=u.ND.channel("comments:".concat(t)).on("postgres_changes",{event:"INSERT",schema:"public",table:"comment",filter:"post_id=eq.".concat(t)},e=>{l(t=>[e.new,...t])}).subscribe();return()=>u.ND.removeChannel(e)},[t]),"loading"===b)?(0,a.jsx)("div",{className:"text-cyan-200",children:"Loading comments..."}):"error"===b?(0,a.jsx)("div",{className:"text-red-400",children:"Error loading comments!"}):(0,a.jsxs)("div",{className:"space-y-4",children:[c.concat((null==m?void 0:m.pages.flatMap(e=>e.comments))||[]).map((e,t)=>{var s,o;return(0,a.jsxs)("div",{className:"cosmic-post-3d cosmic-glow rounded-lg border border-cyan-500/30 p-4 bg-gradient-to-br from-cyan-900/30 to-blue-900/20 backdrop-blur-lg depth-3",style:{transform:"translateZ(".concat(10+5*t,"px)")},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:(null==(o=e.username)||null==(s=o.charAt(0))?void 0:s.toUpperCase())||"A"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-semibold",children:e.username||"Cosmic Traveler"}),(0,a.jsx)("div",{className:"text-gray-400 text-xs",children:e.zodiac_sign})]})]}),(0,a.jsx)("p",{className:"text-white",children:e.content}),(0,a.jsx)("div",{className:"text-gray-400 text-xs mt-2",children:new Date(e.created_at).toLocaleDateString()})]},"".concat(e.id,"-").concat(t))}),(0,a.jsxs)("div",{ref:s,className:"text-center",children:[y&&(0,a.jsx)("div",{className:"text-cyan-200",children:"Loading more comments..."}),!g&&(0,a.jsx)("div",{className:"text-gray-500",children:"No more comments to load."})]})]})}function y(e){let{post:t,index:s}=e,[d,u]=(0,o.useState)(!1),[p,m]=(0,o.useState)(!1),[h,x]=(0,o.useState)({x:0,y:0}),f=(0,o.useRef)(null);return(0,a.jsxs)("article",{ref:f,className:"\n        cosmic-post-3d cosmic-glow rounded-2xl border border-purple-500/30 p-6 shadow-2xl\n        bg-gradient-to-br from-purple-900/30 to-blue-900/20 backdrop-blur-lg\n        ".concat((()=>{let e=["cosmic-float-3d","cosmic-float-3d-reverse","cosmic-float-3d-slow"];return e[s%e.length]})(),"\n      "),style:(()=>{let e=10*h.y,t=-10*h.x,s=20*Math.abs(h.x+h.y);return{"--mouse-rotate-x":"".concat(e,"deg"),"--mouse-rotate-y":"".concat(t,"deg"),"--mouse-translate-z":"".concat(s,"px")}})(),onMouseMove:e=>{if(!f.current)return;let t=f.current.getBoundingClientRect();x({x:((e.clientX-t.left)/t.width-.5)*2,y:((e.clientY-t.top)/t.height-.5)*2})},onMouseLeave:()=>{x({x:0,y:0})},children:[(0,a.jsxs)("header",{className:"flex items-center justify-between mb-4 depth-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold cosmic-pulse depth-3",style:{"--depth-mouse-z":"".concat(5*h.x,"px")},children:t.username.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"depth-2",children:[(0,a.jsx)("div",{className:"text-white font-semibold",children:t.username}),(0,a.jsx)("div",{className:"text-purple-300 text-sm",children:t.zodiac_sign})]})]}),(0,a.jsx)("time",{className:"text-gray-400 text-sm depth-1",children:new Date(t.created_at).toLocaleDateString()})]}),(0,a.jsx)("button",{className:"text-white mb-4 transition-all duration-300 depth-2 text-left ".concat(p?"":"line-clamp-3"),onClick:()=>m(!p),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),m(!p))},style:{"--depth-mouse-z":"".concat(5*Math.abs(h.y),"px")},"aria-expanded":p,children:t.content}),t.image_url&&(0,a.jsx)("figure",{className:"mb-4 rounded-xl overflow-hidden border border-purple-500/30 depth-3",style:{"--depth-mouse-z":"".concat(10*Math.abs(h.x),"px")},children:(0,a.jsx)("img",{src:t.image_url,alt:"Post media",className:"w-full h-auto max-h-96 object-cover transition-transform duration-700 hover:scale-110"})}),t.video_url&&(0,a.jsx)("figure",{className:"mb-4 rounded-xl overflow-hidden border border-purple-500/30 depth-3",style:{"--depth-mouse-z":"".concat(10*Math.abs(h.x),"px")},children:(0,a.jsx)(l.Ay,{height:384,offset:100,children:t.hls_url||t.video_url?(0,a.jsx)("video",{src:t.hls_url||t.video_url,controls:!0,className:"w-full h-auto max-h-96 object-cover"}):t.image_url?(0,a.jsx)("img",{src:t.image_url,alt:t.content,className:"w-full h-auto max-h-96 object-cover"}):null})}),(0,a.jsx)("div",{className:"flex justify-between items-center text-sm text-gray-400 mb-4 depth-1",style:{"--depth-mouse-z":"".concat(3*Math.abs(h.y),"px")},children:(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(r.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:t.spark_count})]}),(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(n.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:t.echo_count})]}),(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(c.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:t.comment_count})]})]})}),(0,a.jsxs)("div",{className:"flex space-x-4 border-t border-purple-500/20 pt-4 depth-2",style:{"--depth-mouse-z":"".concat(4*Math.abs(h.x),"px")},children:[(0,a.jsx)(i,{isSparked:!1,sparkCount:t.spark_count,onSpark:()=>console.log("Spark clicked"),size:"md",variant:"cosmic"}),(0,a.jsxs)("button",{onClick:()=>u(!d),className:"flex items-center space-x-2 text-gray-400 hover:text-purple-400 transition-colors transform hover:scale-110 hover:translateZ(10px)","aria-label":"Toggle comments","aria-expanded":!!d,children:[(0,a.jsx)(c.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Comment"})]}),(0,a.jsxs)("button",{className:"flex items-center space-x-2 text-gray-400 hover:text-green-400 transition-colors transform hover:scale-110 hover:translateZ(10px)","aria-label":"Echo this post",children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Echo"})]})]}),d&&(0,a.jsx)("section",{className:"mt-4 border-t border-purple-500/20 pt-4 depth-4",style:{"--depth-mouse-z":"0px"},children:(0,a.jsx)(g,{postId:t.id.toString()})})]})}function b(e){let{posts:t}=e,[s,r]=(0,o.useState)(0),n=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let e=()=>{r(window.scrollY)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]),(0,a.jsxs)("div",{ref:n,className:"cosmic-feed-3d relative min-h-screen",style:{"--scroll-y":"".concat(s,"px")},children:[(0,a.jsxs)("div",{className:"fixed inset-0 pointer-events-none overflow-hidden",children:[(0,a.jsx)("div",{className:"cosmic-particle particle-1"}),(0,a.jsx)("div",{className:"cosmic-particle particle-2"}),(0,a.jsx)("div",{className:"cosmic-particle particle-3"}),(0,a.jsx)("div",{className:"cosmic-nebula nebula-1"}),(0,a.jsx)("div",{className:"cosmic-nebula nebula-2"})]}),(0,a.jsxs)("div",{className:"relative z-10 max-w-2xl mx-auto px-4 py-8 space-y-8",children:[(0,a.jsxs)("header",{className:"text-center mb-12 cosmic-feed-header",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white mb-4 cosmic-glow",children:"Cosmic Feed"}),(0,a.jsx)("p",{className:"text-purple-300 text-lg",children:"Explore the depths of shared consciousness"})]}),(0,a.jsx)("div",{className:"space-y-8",children:t.map((e,t)=>(0,a.jsx)("div",{className:"cosmic-post-wrapper",style:{"--stagger-delay":"".concat(.1*t,"s"),"--scroll-offset":"".concat(.1*s,"px")},children:(0,a.jsx)(y,{post:e,index:t})},e.id))}),t.length>0&&(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("div",{className:"cosmic-load-more text-purple-400 hover:text-purple-300 transition-colors cursor-pointer",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("div",{className:"cosmic-spinner"}),(0,a.jsx)("span",{children:"Load more cosmic posts..."})]})})}),0===t.length&&(0,a.jsx)("div",{className:"text-center py-20",children:(0,a.jsx)("div",{className:"cosmic-empty-state text-gray-400 text-xl",children:"No posts yet. Be the first to share your cosmic thoughts!"})})]})]})}g.propTypes={postId:h().string.isRequired};var v=s(8205),N=s(6958),j=s(8230),w=s.n(j);function _(){let{user:e}=(0,v.A)(),[t,s]=(0,o.useState)([]),[r,n]=(0,o.useState)(""),[c,l]=(0,o.useState)(""),[i,d]=(0,o.useState)({}),[u,p]=(0,o.useState)(!0),[m,h]=(0,o.useState)("");(0,o.useEffect)(()=>{if(!e)return;let t=async()=>{try{let t=await fetch("".concat("https://star-backend.azurewebsites.net","/api/v1/posts"),{headers:{Authorization:"Bearer ".concat(e.id)}}),a=await t.json();a.posts&&s(a.posts),p(!1)}catch(e){h("Failed to load posts"),p(!1)}};t();let a=(0,N.UU)("https://dummy.supabase.co","dummy_key"),o=a.channel("posts").on("postgres_changes",{event:"*",schema:"public",table:"posts"},()=>t()).on("postgres_changes",{event:"*",schema:"public",table:"likes"},()=>t()).on("postgres_changes",{event:"*",schema:"public",table:"comments"},()=>t()).subscribe();return()=>{a.removeChannel(o)}},[e]);let x=async()=>{if(!r.trim())return void h("Post content is required");try{let t=await fetch("".concat("https://star-backend.azurewebsites.net","/api/v1/posts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat((null==e?void 0:e.id)||"")},body:JSON.stringify({content:r,media_url:c||void 0})}),s=await t.json();s.success?(n(""),l(""),h("")):h(s.error||"Failed to create post")}catch(e){h("Network error")}};return e?u?(0,a.jsx)("p",{className:"text-white p-4",children:"Loading cosmic feed..."}):m?(0,a.jsx)("p",{className:"text-red-500 p-4",children:m}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:[(0,a.jsx)(w(),{href:"/home",className:"text-blue-400 hover:underline mb-4 inline-block p-4",children:"Back to Cosmic Home"}),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto mb-8 p-6 bg-gray-800/50 backdrop-blur-lg rounded-2xl border border-purple-500/30",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Share Your Cosmic Thoughts"}),(0,a.jsx)("textarea",{value:r,onChange:e=>n(e.target.value),placeholder:"Share your cosmic thoughts...",className:"w-full p-3 rounded-lg bg-gray-900/50 text-white mb-3 border border-purple-500/30 focus:border-purple-400 focus:outline-none",rows:4}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>l(e.target.value),placeholder:"Optional Spotify track URL (e.g., https://open.spotify.com/track/xyz)",className:"w-full p-3 rounded-lg bg-gray-900/50 text-white mb-3 border border-purple-500/30 focus:border-purple-400 focus:outline-none"}),(0,a.jsx)("button",{onClick:x,className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105",children:"Post to the Cosmos"})]}),(0,a.jsx)(b,{posts:t.map(e=>({id:e.id,content:e.content,username:e.profiles.display_name,zodiac_sign:e.zodiac_sign,image_url:e.media_url,spark_count:e.like_count,echo_count:0,comment_count:e.comments.length,created_at:e.created_at}))})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-black text-white p-4",children:[(0,a.jsx)("h1",{className:"text-3xl",children:"Please Log In"}),(0,a.jsx)("p",{children:"Access the cosmic feed after signing in."})]})}},4510:(e,t,s)=>{"use strict";s.d(t,{ND:()=>a});let a=(0,s(6958).UU)("https://dummy.supabase.co","dummy_key")},4563:(e,t,s)=>{"use strict";s.d(t,{T:()=>m,p:()=>p});var a=s(7876),o=s(1040),r=s(5062),n=s.n(r),c=s(4232),l=s(2692),i=s(5364);let d=(0,c.createContext)(),u=(e,t)=>{switch(t.type){case"SET_ONLINE_USERS":return{...e,onlineUsers:new Map(t.payload)};case"UPDATE_USER_POSITION":let s=new Map(e.onlineUsers);return s.set(t.payload.userId,t.payload),{...e,onlineUsers:s};case"ADD_CONSTELLATION":let a=new Map(e.constellations);return a.set(t.payload.id,t.payload),{...e,constellations:a};case"SET_CURRENT_USER":return{...e,currentUser:t.payload};case"SET_SOCKET":return{...e,socket:t.payload};case"SET_CONNECTED":return{...e,isConnected:t.payload};case"ADD_RECENT_ACTION":return{...e,recentActions:[t.payload,...e.recentActions.slice(0,9)]};default:return e}},p=e=>{let{children:t}=e,[s,r]=(0,c.useReducer)(u,{onlineUsers:new Map,constellations:new Map,currentUser:null,socket:null,isConnected:!1,recentActions:[]});(0,c.useEffect)(()=>{let e=(0,l.io)(i.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:5000");return e.on("connect",()=>{console.log("Connected to collaboration server"),r({type:"SET_CONNECTED",payload:!0}),e.emit("join_cosmic_collaboration",{user_id:localStorage.getItem("userId")||"anonymous"})}),e.on("disconnect",()=>{console.log("Disconnected from collaboration server"),r({type:"SET_CONNECTED",payload:!1})}),e.on("user_position_update",e=>{r({type:"UPDATE_USER_POSITION",payload:{userId:e.user_id,name:e.username,position:e.position,rotation:e.rotation}})}),e.on("constellation_created",e=>{r({type:"ADD_CONSTELLATION",payload:e.constellation})}),e.on("collaboration_state",e=>{if(e.online_users){let t=new Map;e.online_users.forEach(e=>{t.set(e.user_id,{userId:e.user_id,name:"User ".concat(e.user_id.slice(-4)),position:[e.x||0,e.y||0,e.z||0],rotation:e.rotation||0})}),r({type:"SET_ONLINE_USERS",payload:t})}if(e.constellations){let t=new Map;e.constellations.forEach(e=>{t.set(e.id,e)}),e.constellations.forEach(e=>{r({type:"ADD_CONSTELLATION",payload:e})})}}),e.on("cosmic_collaboration_joined",e=>{console.log("Joined cosmic collaboration:",e)}),e.on("action_notification",e=>{r({type:"ADD_RECENT_ACTION",payload:{id:Date.now(),userId:e.user_id,username:e.username,action:e.action,actionType:e.action_type,timestamp:e.timestamp}})}),r({type:"SET_SOCKET",payload:e}),()=>e.disconnect()},[]);let n=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(s.currentUser)try{await o.A.post("/api/v1/collaboration/position",{x:e[0],y:e[1],z:e[2],rotation:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})}catch(e){console.error("Failed to update position:",e)}},p=async e=>{try{return(await o.A.post("/api/v1/constellations",e,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data}catch(e){throw console.error("Failed to create constellation:",e),e}},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cosmos";try{return(await o.A.post("/api/v1/action",{action_type:e,room:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data}catch(e){throw console.error("Failed to trigger zodiac action:",e),e}};return(0,a.jsx)(d.Provider,{value:{...s,updateUserPosition:n,createConstellation:p,triggerZodiacAction:m,getUsersInRoom:()=>Array.from(s.onlineUsers.values()),getConstellations:()=>Array.from(s.constellations.values())},children:t})};p.propTypes={children:n().node.isRequired};let m=()=>{let e=(0,c.useContext)(d);if(!e)throw Error("useCollaboration must be used within CollaborationProvider");return e}},8205:(e,t,s)=>{"use strict";s.d(t,{A:()=>r}),s(7876);var a=s(4232);let o=(0,a.createContext)({user:null,loading:!0,login:()=>{},logout:()=>{}}),r=()=>(0,a.useContext)(o)}},e=>{e.O(0,[2909,1040,6958,8230,2041,7167,636,6593,8792],()=>e(e.s=252)),_N_E=e.O()}]);