"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1161,3542],{3542:(e,t,a)=>{a.r(t),a.d(t,{AgoraUIKitLiveStream:()=>c});var o=a(7876),n=a(4563),r=a(4510),s=a(4141),l=a(4232),i=a(5364);function c(e){let{streamId:t,isHost:a=!1}=e,[c,d]=(0,l.useState)(null),[u,p]=(0,l.useState)(!0),[m,h]=(0,l.useState)(null),{socket:_,currentUser:y}=(0,n.T)();if((0,l.useEffect)(()=>{(async()=>{try{let{data:{session:e}}=await r.ND.auth.getSession();if(!e){h("Please log in to view live streams"),p(!1);return}let a=await fetch("".concat("https://star-backend.azurewebsites.net","/api/v1/live-stream/").concat(t),{headers:{Authorization:"Bearer ".concat(e.access_token)}});if(a.ok){let{stream:e}=await a.json();d(e)}else h("Stream not found or inactive")}catch(e){h("Failed to load stream"),console.error("Error fetching stream:",e)}finally{p(!1)}})()},[t]),(0,l.useEffect)(()=>{_&&c&&_.emit("join_stream",{streamId:c.id})},[_,c]),u)return(0,o.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,o.jsx)("div",{className:"text-white",children:"Loading stream..."})});if(m||!c)return(0,o.jsx)("div",{className:"flex items-center justify-center h-64 bg-black/50 rounded-lg",children:(0,o.jsx)("div",{className:"text-red-400",children:m||"Stream not available"})});let E={appId:i.env.NEXT_PUBLIC_AGORA_APP_ID,channel:c.channel_name,token:c.agora_token};return(0,o.jsxs)("div",{className:"w-full h-full bg-black rounded-lg overflow-hidden",children:[(0,o.jsxs)("div",{className:"p-4 bg-gradient-to-r from-purple-900 to-blue-900",children:[(0,o.jsx)("h2",{className:"text-white text-xl font-bold",children:c.title}),(0,o.jsxs)("p",{className:"text-gray-300",children:["Hosted by ",c.username," (",c.zodiac_sign,")"]})]}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)(s.Ay,{rtcProps:E,callbacks:{EndCall:async()=>{if(a){let{data:{session:e}}=await r.ND.auth.getSession();e&&await fetch("".concat("https://star-backend.azurewebsites.net","/api/v1/live-stream/").concat(t,"/end"),{method:"POST",headers:{Authorization:"Bearer ".concat(e.access_token)}})}console.log("Call ended")}},styleProps:{UIKitContainer:{height:"600px",width:"100%"},localBtnContainer:{backgroundColor:"#1a1a1a"},localBtnStyles:{muteLocalAudio:{backgroundColor:"#4a5568"},muteLocalVideo:{backgroundColor:"#4a5568"},switchCamera:{backgroundColor:"#4a5568"},endCall:{backgroundColor:"#e53e3e"}}}}),(0,o.jsxs)("div",{className:"absolute top-4 left-4 bg-black/70 text-white p-3 rounded-lg",children:[(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,o.jsx)("span",{className:"text-sm font-medium",children:"LIVE"})]}),(0,o.jsx)("p",{className:"text-xs text-gray-300 mt-1",children:"Cosmic Stream"})]})]})]})}},4510:(e,t,a)=>{a.d(t,{ND:()=>o});let o=(0,a(6958).UU)("https://dummy.supabase.co","dummy_key")},4563:(e,t,a)=>{a.d(t,{T:()=>m,p:()=>p});var o=a(7876),n=a(1040),r=a(5062),s=a.n(r),l=a(4232),i=a(2692),c=a(5364);let d=(0,l.createContext)(),u=(e,t)=>{switch(t.type){case"SET_ONLINE_USERS":return{...e,onlineUsers:new Map(t.payload)};case"UPDATE_USER_POSITION":let a=new Map(e.onlineUsers);return a.set(t.payload.userId,t.payload),{...e,onlineUsers:a};case"ADD_CONSTELLATION":let o=new Map(e.constellations);return o.set(t.payload.id,t.payload),{...e,constellations:o};case"SET_CURRENT_USER":return{...e,currentUser:t.payload};case"SET_SOCKET":return{...e,socket:t.payload};case"SET_CONNECTED":return{...e,isConnected:t.payload};case"ADD_RECENT_ACTION":return{...e,recentActions:[t.payload,...e.recentActions.slice(0,9)]};default:return e}},p=e=>{let{children:t}=e,[a,r]=(0,l.useReducer)(u,{onlineUsers:new Map,constellations:new Map,currentUser:null,socket:null,isConnected:!1,recentActions:[]});(0,l.useEffect)(()=>{let e=(0,i.io)(c.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:5000");return e.on("connect",()=>{console.log("Connected to collaboration server"),r({type:"SET_CONNECTED",payload:!0}),e.emit("join_cosmic_collaboration",{user_id:localStorage.getItem("userId")||"anonymous"})}),e.on("disconnect",()=>{console.log("Disconnected from collaboration server"),r({type:"SET_CONNECTED",payload:!1})}),e.on("user_position_update",e=>{r({type:"UPDATE_USER_POSITION",payload:{userId:e.user_id,name:e.username,position:e.position,rotation:e.rotation}})}),e.on("constellation_created",e=>{r({type:"ADD_CONSTELLATION",payload:e.constellation})}),e.on("collaboration_state",e=>{if(e.online_users){let t=new Map;e.online_users.forEach(e=>{t.set(e.user_id,{userId:e.user_id,name:"User ".concat(e.user_id.slice(-4)),position:[e.x||0,e.y||0,e.z||0],rotation:e.rotation||0})}),r({type:"SET_ONLINE_USERS",payload:t})}if(e.constellations){let t=new Map;e.constellations.forEach(e=>{t.set(e.id,e)}),e.constellations.forEach(e=>{r({type:"ADD_CONSTELLATION",payload:e})})}}),e.on("cosmic_collaboration_joined",e=>{console.log("Joined cosmic collaboration:",e)}),e.on("action_notification",e=>{r({type:"ADD_RECENT_ACTION",payload:{id:Date.now(),userId:e.user_id,username:e.username,action:e.action,actionType:e.action_type,timestamp:e.timestamp}})}),r({type:"SET_SOCKET",payload:e}),()=>e.disconnect()},[]);let s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(a.currentUser)try{await n.A.post("/api/v1/collaboration/position",{x:e[0],y:e[1],z:e[2],rotation:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})}catch(e){console.error("Failed to update position:",e)}},p=async e=>{try{return(await n.A.post("/api/v1/constellations",e,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data}catch(e){throw console.error("Failed to create constellation:",e),e}},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cosmos";try{return(await n.A.post("/api/v1/action",{action_type:e,room:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})).data}catch(e){throw console.error("Failed to trigger zodiac action:",e),e}};return(0,o.jsx)(d.Provider,{value:{...a,updateUserPosition:s,createConstellation:p,triggerZodiacAction:m,getUsersInRoom:()=>Array.from(a.onlineUsers.values()),getConstellations:()=>Array.from(a.constellations.values())},children:t})};p.propTypes={children:s().node.isRequired};let m=()=>{let e=(0,l.useContext)(d);if(!e)throw Error("useCollaboration must be used within CollaborationProvider");return e}}}]);