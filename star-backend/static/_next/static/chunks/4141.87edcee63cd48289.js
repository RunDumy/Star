"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4141],{4141:(e,n,t)=>{t.d(n,{Ay:()=>ep});var r,o,i,u,a,l,c,s,d,m=t(4232),f=t(6860),E=t.n(f);!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(r||(r={}));var v=function(e){var n=(0,m.useRef)(null),t=e.videoTrack,r=e.config,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}(e,["videoTrack","config"]);return(0,m.useLayoutEffect)(function(){return null!==n.current&&t.play(n.current,r),function(){t.stop()}},[t]),m.createElement("div",Object.assign({},o,{ref:n}))};let h=E();var _=t(2230),R=t.n(_);!function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(o||(o={}));let I=R();function S(){return(S=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function T(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var A=m.createContext({}),p=A.Provider;A.Consumer,function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"}(i||(i={})),function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"}(u||(u={})),function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"}(a||(a={}));var C=m.createContext({rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}}),y=C.Provider,g=m.createContext([]),N=g.Provider,O=g.Consumer,P=m.createContext([]),x=P.Provider,b=P.Consumer,D=m.createContext({}),L=D.Provider,k={max:[{uid:0,hasAudio:i.no,hasVideo:i.no}],min:[],isScreensharing:!1},U=function(e,n){var t=k,r=[].concat(e.max,e.min).map(function(e){return e.uid});switch(n.type){case"Screensharing":t=S({},e,{isScreensharing:n.value[0]}),console.log("!Screensharingstate",e,t);break;case"update-user-video":t={min:e.min.map(function(e){return 0===e.uid?{uid:0,hasAudio:i.subbed,hasVideo:i.subbed}:e}),max:e.max.map(function(e){return 0===e.uid?{uid:0,hasAudio:i.subbed,hasVideo:i.subbed}:e}),isScreensharing:e.isScreensharing};break;case"user-joined":if(-1===r.indexOf(n.value[0].uid)){var o=[].concat(e.min,[{uid:n.value[0].uid,hasAudio:i.no,hasVideo:i.no}]);t=1===o.length&&0===e.max[0].uid?{max:o,min:e.max,isScreensharing:e.isScreensharing}:{min:o,max:e.max,isScreensharing:e.isScreensharing}}break;case"user-unpublished":if(e.max[0].uid===n.value[0].uid)t={max:[{uid:n.value[0].uid,hasAudio:"audio"===n.value[1]?i.no:e.max[0].hasAudio,hasVideo:"video"===n.value[1]?i.no:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing};else{var u=e.min.find(function(e){return e.uid===n.value[0].uid});u&&(t={min:[].concat(e.min.filter(function(e){return e.uid!==n.value[0].uid}),[{uid:n.value[0].uid,hasAudio:"audio"===n.value[1]?i.no:u.hasAudio,hasVideo:"video"===n.value[1]?i.no:u.hasVideo}]),max:e.max,isScreensharing:e.isScreensharing})}break;case"user-published":t=e.max[0].uid===n.value[0].uid?{max:[{uid:n.value[0].uid,hasAudio:"audio"===n.value[1]?i.subbed:e.max[0].hasAudio,hasVideo:"video"===n.value[1]?i.subbed:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing}:{min:e.min.map(function(e){return e.uid!==n.value[0].uid?e:{uid:e.uid,hasAudio:"audio"===n.value[1]?i.subbed:e.hasAudio,hasVideo:"video"===n.value[1]?i.subbed:e.hasVideo}}),max:e.max,isScreensharing:e.isScreensharing};break;case"user-left":if(e.max[0].uid===n.value[0].uid){var a=[].concat(e.min);t={max:[a.pop()],min:a,isScreensharing:e.isScreensharing}}else t={min:e.min.filter(function(e){return e.uid!==n.value[0].uid}),max:e.max,isScreensharing:e.isScreensharing};break;case"user-swap":e.max[0].uid===n.value[0].uid||(t={max:[n.value[0]],min:[].concat(e.min.filter(function(e){return e.uid!==n.value[0].uid}),[e.max[0]]),isScreensharing:e.isScreensharing});break;case"local-user-mute-video":t={min:e.min.map(function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:n.value[0]}:e}),max:e.max.map(function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:n.value[0]}:e}),isScreensharing:e.isScreensharing};break;case"local-user-mute-audio":t={min:e.min.map(function(e){return 0===e.uid?{uid:0,hasAudio:n.value[0],hasVideo:e.hasVideo}:e}),max:e.max.map(function(e){return 0===e.uid?{uid:0,hasAudio:n.value[0],hasVideo:e.hasVideo}:e}),isScreensharing:e.isScreensharing};break;case"remote-user-mute-video":t={min:e.min.map(function(e){return e.uid===n.value[0].uid?{uid:e.uid,hasVideo:n.value[1],hasAudio:e.hasAudio}:e}),max:e.max.map(function(e){return e.uid===n.value[0].uid?{uid:e.uid,hasVideo:n.value[1],hasAudio:e.hasAudio}:e}),isScreensharing:e.isScreensharing};break;case"remote-user-mute-audio":t={min:e.min.map(function(e){return e.uid===n.value[0].uid?{uid:e.uid,hasAudio:n.value[1],hasVideo:e.hasVideo}:e}),max:e.max.map(function(e){return e.uid===n.value[0].uid?{uid:e.uid,hasAudio:n.value[1],hasVideo:e.hasVideo}:e}),isScreensharing:e.isScreensharing};break;case"leave-channel":t=k;break;case"ActiveSpeaker":t=e.max[0].uid===n.value[0]?S({},e):{max:[e.min.find(function(e){return e.uid===n.value[0]})],min:[].concat(e.min.filter(function(e){return e.uid!==n.value[0]}),[e.max[0]]),isScreensharing:e.isScreensharing}}return console.log("!state-update",S({},e,t),t),S({},e,t)},M=function(e,n,t,r,o,i,u){try{var a=function(){try{c.setClientRole("host");var t=function(){if(!i)return Promise.resolve(c.join(e,n,r||null,d||0)).then(function(e){s=e});var t=T(function(){return Promise.resolve(fetch(i+"/rtc/"+n+"/publisher/uid/"+d+"/")).then(function(t){return Promise.resolve(t.json()).then(function(t){var r=t.rtcToken;return Promise.resolve(c.join(e,n,r,d)).then(function(e){s=e})})})},function(e){console.log(e)});if(t&&t.then)return t.then(function(){})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},l=function(){try{var e=function(){var e=function(){if(t.enabled){var e=function(){if(!m)return Promise.resolve(c.publish([t]).then(function(){m=!0})).then(function(){})}();if(e&&e.then)return e.then(function(){})}}();if(e&&e.then)return e.then(function(){})},n=function(){if(u)return Promise.resolve(c.enableDualStream()).then(function(){})}();return Promise.resolve(n&&n.then?n.then(e):e(n))}catch(e){return Promise.reject(e)}},c=h.createClient({mode:"live",role:"host",codec:"vp8"}),s=0,d=o||1,m=!1;return V=function(){try{var e=T(function(){return t.close(),Promise.resolve(c.leave()).then(function(){c.removeAllListeners()})},function(e){console.log(e)});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},Promise.resolve(function(){try{try{console.log(c),i&&(c.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(i+"/rtc/"+n+"/publisher/uid/"+d+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtcToken;c.renewToken(n)})})}catch(e){return Promise.reject(e)}}),c.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(i+"/rtc/"+n+"/publisher/uid/"+d+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtcToken;c.renewToken(n)})})}catch(e){return Promise.reject(e)}})),t.on("track-ended",function(){c.leave(),c.removeAllListeners()})}catch(e){console.log(e)}return Promise.resolve()}catch(e){return Promise.reject(e)}}()).then(function(){return Promise.resolve(a()).then(function(){return Promise.resolve(l()).then(function(){s&&console.log(s)})})})}catch(e){return Promise.reject(e)}},V=function(){},w=function(e){var n;return function(){return n||(n=E().createClient(e)),n}}({codec:"vp8",mode:"live"}),j=function(e){var n=(0,m.useRef)(),t=(0,m.useRef)(),r=(0,m.useRef)(!1),o=(0,m.useContext)(D),i=o.localVideoTrack,a=o.localAudioTrack,l=(0,m.useContext)(C),c=l.callbacks,s=l.rtcProps,d=(0,m.useState)(!1),f=d[0],E=d[1],v=(0,m.useState)(!1),_=v[0],R=v[1],I=null,S=(0,m.useRef)(new Promise(function(e,n){I=e,console.log(n)})),A=w();s.customRtcClient&&(A.removeAllListeners(),A=s.customRtcClient);var y=!1,g=!1,O=(0,m.useRef)({}),P=e.callActive;void 0===P&&(P=!0);var b=(0,m.useReducer)(U,k),L=b[0],j=b[1];return(0,m.useEffect)(function(){return I?(!function(){try{try{if(console.log(A),A.on("user-joined",function(){try{for(var n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];var i=t[0];return i.uid===e.screenshareUid&&r.current||1===i.uid&&r.current||(O.current[i.uid]={}),j({type:"user-joined",value:t}),Promise.resolve()}catch(e){return Promise.reject(e)}}),A.on("user-published",function(){for(var n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];try{var i=t[0],u=t[1];return console.log("user-published",i.uid),i.uid===e.screenshareUid&&r.current||1===i.uid&&r.current?j({type:"user-published",value:t}):A.subscribe(i,u).then(function(e){if(O.current[i.uid][u+"Track"]=i[u+"Track"],"audio"===u){var n;null==(n=i.audioTrack)||n.play()}else s.enableDualStream&&s.dualStreamMode&&A.setStreamFallbackOption(i.uid,s.dualStreamMode);j({type:"user-published",value:t})}).catch(function(e){return console.log(e)}),Promise.resolve()}catch(e){return Promise.reject(e)}}),A.on("user-unpublished",function(){try{for(var e,n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];var o=t[0],i=t[1];return console.log("user-unpublished",o.uid),"audio"===i&&(null==(e=o.audioTrack)||e.stop()),j({type:"user-unpublished",value:t}),Promise.resolve()}catch(e){return Promise.reject(e)}}),A.on("connection-state-change",function(){try{for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var o=n[0],i=n[1],u=n[2];if(console.log("connection",i,o,u),"CONNECTED"===o)R(!0);else if("DISCONNECTED"===o){try{V(),r.current=!1}catch(e){console.log("stopscreenshare",e)}j({type:"leave-channel",value:null})}else R(!1);return Promise.resolve()}catch(e){return Promise.reject(e)}}),A.on("user-left",function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];j({type:"user-left",value:n})}),s.tokenUrl){var n=s.tokenUrl,t=s.channel,o=s.uid;A.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(n+"/rtc/"+t+"/publisher/uid/"+(o||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtcToken;A.renewToken(n)})})}catch(e){return Promise.reject(e)}}),A.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(n+"/rtc/"+t+"/publisher/uid/"+(o||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtcToken;A.renewToken(n)})})}catch(e){return Promise.reject(e)}})}c&&Object.keys(c).map(function(e){try{A.on(e,function(){for(var n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];c[e].apply(null,t)})}catch(e){console.log(e)}}),I(!0),E(!0)}catch(e){console.log("!!!",e)}Promise.resolve()}catch(e){return Promise.reject(e)}}(),function(){try{A.removeAllListeners()}catch(e){console.log(e)}}):function(){}},[s.appId]),(0,m.useEffect)(function(){var e=!1;return P?(!function(){try{Promise.resolve(S.current).then(function(){var t=s.tokenUrl,r=s.channel,o=s.uid,i=s.appId,u=s.token,a=function(){if(A&&!e){"audience"===s.role?A.setClientRole(s.role):A.setClientRole("host");var a=function(){if(!t)return Promise.resolve(A.join(i,r,u||null,o||0)).then(function(e){n.current=e});var e=T(function(){return Promise.resolve(fetch(t+"/rtc/"+r+"/publisher/uid/"+(o||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){var t=e.rtcToken;return Promise.resolve(A.join(i,r,t,o||0)).then(function(e){n.current=e})})})},function(e){console.log(e)});if(e&&e.then)return e.then(function(){})}();if(a&&a.then)return a.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(a&&a.then)return a.then(function(){})})}catch(e){return Promise.reject(e)}}(),console.log("Attempted join: ",s.channel)):console.log("In precall - waiting to join"),function(){if(e=!0,P){console.log("Leaving channel");try{V(),r.current=!1}catch(e){console.log(e)}S.current=A.leave().catch(function(e){return console.log(e)})}}},[s.channel,s.uid,P,s.tokenUrl]),(0,m.useEffect)(function(){console.log("Publish",i,a,P),P&&function(){try{var e=function(){function e(){var e=function(){if(null!=i&&i.enabled&&_){var e=function(){if(!y)return Promise.resolve(A.publish([i]).then(function(){y=!0})).then(function(){})}();if(e&&e.then)return e.then(function(){})}}();if(e&&e.then)return e.then(function(){})}var n=function(){if(null!=a&&a.enabled&&_){var e=function(){if(!g)return Promise.resolve(A.publish([a]).then(function(){g=!0})).then(function(){})}();if(e&&e.then)return e.then(function(){})}}();return n&&n.then?n.then(e):e(n)},n=function(){if(s.enableDualStream)return Promise.resolve(A.enableDualStream()).then(function(){})}();Promise.resolve(n&&n.then?n.then(e):e(n))}catch(e){return Promise.reject(e)}}()},[P,null==i?void 0:i.enabled,null==a?void 0:a.enabled,_]),(0,m.useEffect)(function(){i&&null!==a&&(O.current[0]={audioTrack:a,videoTrack:i},j({type:"update-user-video",value:[a,i]}))},[s.channel,_]),(0,m.useEffect)(function(){_&&s.token&&A.renewToken(s.token).then(function(e){return console.log("renewed token",e)})},[s.token,_]),(0,m.useEffect)(function(){s.role&&A.setClientRole(s.role).then(function(e){return console.log("changed role",e)})},[s.role,_]),(0,m.useEffect)(function(){return P&&function(){try{var e=function(){if(s.activeSpeaker&&s.layout!==u.grid)return A.on("volume-indicator",function(e){var t=e.reduce(function(e,n){return null===e||n.level>e.level?n:e},null),r=t?t.uid:void 0,o=r===n.current?0:r;void 0!==r&&j({type:"ActiveSpeaker",value:[o]})}),Promise.resolve(A.enableAudioVolumeIndicator()).then(function(){})}();Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){A.removeAllListeners("volume-indicator")}},[s.activeSpeaker,s.layout]),m.createElement(p,{value:{client:A,mediaStore:O.current,localVideoTrack:i,localAudioTrack:a,dispatch:j,localUid:n,channelJoined:_,toggleScreensharing:function(){try{return r.current?(V(),r.current=!1):!function(){try{j({type:"Screensharing",value:[!0]}),Promise.resolve(h.createScreenVideoTrack({},"disable")).then(function(e){t.current=e;var n=s.screenshareUid||1;return O.current[n]={videoTrack:t.current},t.current.on("track-ended",function(){r.current=!1,j({type:"Screensharing",value:[!1]})}),r.current=!0,Promise.resolve(M(s.appId,s.channel,t.current,s.screenshareToken,s.screenshareUid,s.tokenUrl,s.enableDualStream)).then(function(){})})}catch(e){return Promise.reject(e)}}(),Promise.resolve()}catch(e){return Promise.reject(e)}},isScreensharing:r.current}},m.createElement(N,{value:L.max},m.createElement(x,{value:L.min},f?e.children:null)))},F={videocam:m.createElement(m.Fragment,null,m.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),m.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:m.createElement(m.Fragment,null,m.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),m.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:m.createElement(m.Fragment,null,m.createElement("polyline",{points:"15 3 21 3 21 9"}),m.createElement("polyline",{points:"9 21 3 21 3 15"}),m.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),m.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:m.createElement(m.Fragment,null,m.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),m.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:m.createElement(m.Fragment,null,m.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),m.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),m.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),m.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:m.createElement(m.Fragment,null,m.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),m.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),m.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),m.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),m.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:m.createElement(m.Fragment,null,m.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),m.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),m.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:m.createElement(m.Fragment,null,m.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),m.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},G=function(e){var n=e.onClick,t=e.name,r=e.disabled,o=e.style,i=(0,m.useContext)(C).styleProps||{},u=i.theme,a=i.BtnTemplateStyles,l=i.iconSize,c=i.customIcon;return m.createElement("div",{style:S({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:r?"auto":"pointer",margin:4},a,o),onClick:n},c?m.createElement("img",{src:c[t],alt:t}):m.createElement("svg",{style:{width:l||24,height:l||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:r?"0.5":"1",stroke:u||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},F[t]))};function H(){var e=(0,m.useContext)(C),n=e.styleProps,t=e.callbacks,r=((n||{}).localBtnStyles||{}).endCall;return m.createElement(G,{style:r||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(null==t?void 0:t.EndCall)&&t.EndCall()}})}var W=(0,m.createContext)({}),B=function(e){var n,t=(0,m.useContext)(g),r=(0,m.useContext)(P);return n=0===t[0].uid?t[0]:r.find(function(e){return 0===e.uid}),m.createElement(W.Provider,{value:n},e.children)},K=function(e,n,t,r){try{var o=function(){if(0===e.uid){var o=e.hasAudio,i=function(){if(o===a.enabled||o===a.disabled){var e=o===a.enabled?a.disabling:a.enabling;n({type:"local-user-mute-audio",value:[e]}),r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e);var i=T(function(){return Promise.resolve(null==t?void 0:t.setEnabled(o!==a.enabled)).then(function(){e=o===a.enabled?a.disabled:a.enabled,r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e),n({type:"local-user-mute-audio",value:[o===a.enabled?a.disabled:a.enabled]})})},function(){n({type:"local-user-mute-audio",value:[o]})});if(i&&i.then)return i.then(function(){})}}();if(i&&i.then)return i.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};function Y(){var e=(0,m.useContext)(C),n=e.styleProps,t=e.callbacks,r=((n||{}).localBtnStyles||{}).muteLocalAudio,o=(0,m.useContext)(A),i=o.dispatch,u=o.localAudioTrack,l=(0,m.useContext)(W);return m.createElement("div",null,m.createElement(G,{style:r,name:l.hasAudio===a.enabled?"mic":"micOff",onClick:function(){return u&&K(l,i,u,t)}}))}function J(){var e=(((0,m.useContext)(C).styleProps||{}).localBtnStyles||{}).screenshare,n=(0,m.useContext)(A),t=n.toggleScreensharing,r=n.isScreensharing;return m.createElement("div",null,m.createElement(G,{style:e,name:r?"stop":"screen",onClick:function(){return t()}}))}var X=function(e,n,t,r){try{var o=function(){if(0===e.uid){var o=e.hasVideo,i=function(){if(o===a.enabled||o===a.disabled){var e=o===a.enabled?a.disabling:a.enabling;n({type:"local-user-mute-video",value:[e]}),r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e);var i=T(function(){return Promise.resolve(null==t?void 0:t.setEnabled(o!==a.enabled)).then(function(){e=o===a.enabled?a.disabled:a.enabled,r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e),n({type:"local-user-mute-video",value:[e]})})},function(){n({type:"local-user-mute-video",value:[o]})});if(i&&i.then)return i.then(function(){})}}();if(i&&i.then)return i.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};function z(){var e=(0,m.useContext)(C),n=e.styleProps,t=e.callbacks,r=((n||{}).localBtnStyles||{}).muteLocalVideo,o=(0,m.useContext)(A),i=o.dispatch,u=o.localVideoTrack,l=(0,m.useContext)(W);return m.createElement("div",null,m.createElement(G,{style:r,name:l.hasVideo===a.enabled?"videocam":"videocamOff",onClick:function(){return u&&X(l,i,u,t)}}))}function Z(){var e=(0,m.useContext)(C),n=e.styleProps,t=e.rtcProps,r=(n||{}).localBtnContainer;return m.createElement("div",{style:S({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},r)},"audience"!==t.role&&m.createElement(z,null),"audience"!==t.role&&m.createElement(Y,null),"audience"!==t.role&&t.enableScreensharing&&m.createElement(J,null),m.createElement(H,null))}!function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"}(l||(l={})),function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"}(c||(c={})),function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"}(s||(s={})),function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"}(d||(d={}));var Q=(0,m.createContext)(null),q=Q.Provider;function $(e){var n=(0,m.useContext)(C).styleProps,t=(0,m.useContext)(Q),r=t.sendMuteRequest,o=t.uidMap,u=((n||{}).remoteBtnStyles||{}).muteRemoteVideo,a=e.UIKitUser,l=a.hasVideo===i.no;return 0!==a.uid&&o[a.uid]?m.createElement("div",null,m.createElement(G,{name:a.hasVideo===i.subbed?"videocam":"videocamOff",style:u,onClick:function(){return r(s.camera,a.uid,!l)}})):null}function ee(e){var n=((0,m.useContext)(C).styleProps||{}).remoteBtnStyles,t=(0,m.useContext)(Q),r=t.sendMuteRequest,o=t.uidMap,u=(n||{}).muteRemoteAudio,a=e.UIKitUser,l=a.hasAudio===i.no;return 0!==a.uid&&o[a.uid]?m.createElement("div",null,m.createElement(G,{style:u,name:a.hasAudio===i.subbed?"mic":"micOff",onClick:function(){return r(s.microphone,a.uid,!l)}})):null}function en(e){var n=(0,m.useContext)(A).dispatch,t=e.UIKitUser;return m.createElement("div",null,m.createElement(G,{name:"remoteSwap",onClick:function(){return n({type:"user-swap",value:[t]})}}))}Q.Consumer;var et=function(e){var n=(0,m.useContext)(C),t=n.styleProps,r=n.rtcProps,o=t||{},i=o.maxViewStyles,u=o.maxViewOverlayContainer,a=e.user,l=r.CustomVideoPlaceholder;return l?l&&l(S({},e),null):m.createElement("div",{key:a.uid,style:S({},er.max,i)},m.createElement("div",{style:er.imgContainer},m.createElement("img",{style:er.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),e.isShown&&m.createElement("div",{style:S({},er.btnContainer,u)},e.showButtons&&m.createElement(m.Fragment,null,!r.disableRtm&&m.createElement($,{UIKitUser:a}),!r.disableRtm&&m.createElement(ee,{UIKitUser:a}),e.showSwap&&m.createElement(en,{UIKitUser:a}))))},er={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},eo=function(e){var n=(0,m.useContext)(Q).usernames,t=(0,m.useContext)(C),r=t.rtmProps,o=t.styleProps,i=e.user;return null!=r&&r.displayUsername?m.createElement("p",{style:S({},ei.username,null==o?void 0:o.usernameText)},1===i.uid?"Screenshare":n[i.uid]):m.createElement(m.Fragment,null)},ei={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},eu=function(e){var n=(0,m.useContext)(A).mediaStore,t=(0,m.useContext)(C),r=t.styleProps,o=t.rtcProps,i=r||{},u=i.maxViewStyles,a=i.videoMode,l=i.maxViewOverlayContainer,c=null==a?void 0:a.max,s=(0,m.useState)(!1),d=s[0],f=s[1],E=e.user;return m.createElement("div",{style:S({},ea.container,e.style,u),onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)}},1===E.hasVideo?m.createElement("div",{style:ea.videoContainer},!o.disableRtm&&m.createElement(eo,{user:E}),m.createElement(v,{style:ea.videoplayer,config:{fit:c||"cover"},videoTrack:n[E.uid].videoTrack}),d&&m.createElement("div",{style:S({},ea.overlay,l)},!o.disableRtm&&m.createElement($,{UIKitUser:E}),!o.disableRtm&&m.createElement(ee,{UIKitUser:E}))):m.createElement("div",{style:ea.videoContainer},!o.disableRtm&&m.createElement(eo,{user:E}),m.createElement(et,{user:E,isShown:d,showButtons:!0})))},ea={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},el=function(e){var n=(0,m.useContext)(A).mediaStore,t=(0,m.useContext)(C),r=t.styleProps,o=t.rtcProps,i=r||{},u=i.minViewStyles,a=i.videoMode,l=i.minViewOverlayContainer,c=null==a?void 0:a.min,s=(0,m.useState)(!1),d=s[0],f=s[1],E=e.user;return m.createElement("div",{style:S({},{display:"flex",flex:1},u),onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)}},1===E.hasVideo?m.createElement("div",{style:S({},{display:"flex",flex:1,position:"relative"})},m.createElement(v,{style:{flex:10,display:"flex"},config:{fit:void 0!==c?c:"cover"},videoTrack:n[E.uid].videoTrack}),d&&m.createElement("div",{style:S({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},l)},!o.disableRtm&&m.createElement($,{UIKitUser:E}),!o.disableRtm&&m.createElement(ee,{UIKitUser:E}),m.createElement(en,{UIKitUser:E}))):m.createElement(et,{user:E,isShown:d,showButtons:!0,showSwap:!0}))},ec={scrollbar:"_3Sxu7"},es=function(){var e=(0,m.useContext)(C),n=e.styleProps,t=e.rtcProps,r=n||{},o=r.minViewContainer,i=r.pinnedVideoContainer,u=r.maxViewContainer,a=r.scrollViewContainer,l=(0,m.useRef)(null),c=(0,m.useState)(0),s=c[0],d=c[1],f=(0,m.useState)(0),E=f[0],v=f[1],h=s>E;return(0,m.useEffect)(function(){var e=function(){l.current&&(d(l.current.offsetWidth),v(l.current.offsetHeight))};return window.addEventListener("resize",e),l.current&&(d(l.current.offsetWidth),v(l.current.offsetHeight)),function(){window.removeEventListener("resize",e)}},[]),m.createElement("div",{ref:l,style:S({},{display:"flex",flex:1,flexDirection:h?"row":"column-reverse",overflow:"hidden"},i)},m.createElement("div",{style:S({},{display:"flex",flex:h?5:4},u)},m.createElement(O,null,function(e){return"audience"===t.role&&0===e[0].uid?null:m.createElement(eu,{user:e[0]})})),m.createElement("div",{className:ec.scrollbar,style:S({},{overflowY:h?"scroll":"hidden",overflowX:h?"hidden":"scroll",display:"flex",flex:1,flexDirection:h?"column":"row"},a)},m.createElement(b,null,function(e){return e.map(function(e){return"audience"===t.role&&0===e.uid?null:m.createElement("div",{style:S({},{minHeight:h?"35vh":"99%",minWidth:h?"99%":"40vw",margin:2,display:"flex"},o),key:e.uid},m.createElement(el,{user:e}))})})))},ed=function(){var e=(0,m.useContext)(C),n=e.styleProps,t=e.rtcProps,r=n||{},o=r.gridVideoCells,i=r.gridVideoContainer,u=(0,m.useContext)(g),a=(0,m.useContext)(P),l="audience"===t.role?[].concat(u,a).filter(function(e){return 0!==e.uid}):[].concat(u,a),c=(0,m.useRef)(null),s=(0,m.useState)(window.innerWidth),d=s[0],f=s[1],E=(0,m.useState)(window.innerHeight),v=E[0],h=E[1],_="minmax(0, 1fr) ";return(0,m.useEffect)(function(){var e=function(){c.current&&(f(c.current.offsetWidth),h(c.current.offsetHeight))};return window.addEventListener("resize",e),c.current&&(f(c.current.offsetWidth),h(c.current.offsetHeight)),function(){window.removeEventListener("resize",e)}},[]),m.createElement("div",{ref:c,style:S({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:d>v?l.length>9?_.repeat(4):l.length>4?_.repeat(3):l.length>1?_.repeat(2):_:l.length>8?_.repeat(3):l.length>2?_.repeat(2):_},i)},l.map(function(e){return m.createElement(eu,{user:e,style:S({},{height:"100%",width:"100%"},o),key:e.uid})}))},em=function(e,n){var t=function(){try{return Promise.resolve(E().createMicrophoneAndCameraTracks(e,n)).then(function(e){return r=e})}catch(e){return Promise.reject(e)}},r=null;return function(){var e=(0,m.useState)(!1),n=e[0],o=e[1],i=(0,m.useState)(null),u=i[0],a=i[1],l=(0,m.useRef)(r);return(0,m.useEffect)(function(){return null===l.current?t().then(function(e){l.current=e,o(!0)},function(e){a(e)}):o(!0),function(){r=null}},[]),{ready:n,tracks:l.current,error:u}}}({encoderConfig:{}},{encoderConfig:{}}),ef=function(e){var n=(0,m.useState)(!1),t=n[0],r=n[1],o=(0,m.useState)(null),i=o[0],u=o[1],a=(0,m.useState)(null),l=a[0],c=a[1],s=em(),d=s.ready,f=s.tracks,E=s.error,v=(0,m.useRef)({});return(0,m.useEffect)(function(){return null!==f?(c(f[0]),u(f[1]),v.current[0]={audioTrack:f[0],videoTrack:f[1]},r(!0)):E&&(console.error(E),r(!1)),function(){if(f){var e,n;null==(e=f[0])||e.close(),null==(n=f[1])||n.close()}}},[d,E]),m.createElement(L,{value:{localVideoTrack:i,localAudioTrack:l}},t?e.children:null)},eE=function(){var e;return function(n,t){return e||(e=n.createChannel(t)),e}}(),ev=function(){var e;return function(n,t,r){return e||(e=R().createInstance(n,t,r)),e}}(),eh=function(e){var n=(0,m.useContext)(C),t=n.rtcProps,r=n.rtmProps,o=(0,m.useState)(!1),i=o[0],u=o[1],a=ev(t.appId),c=eE(a,t.channel),f=(0,m.useRef)(""),E=(0,m.useRef)(5),v=(0,m.useContext)(W),_=(0,m.useContext)(C).rtmCallbacks,R=(0,m.useState)({}),p=R[0],y=R[1],g=(0,m.useState)({}),N=g[0],O=g[1],P=(0,m.useState)({}),x=P[0],b=P[1],D=(0,m.useState)(d.closed),L=D[0],k=D[1],U=(0,m.useState)(l.offline),M=U[0],V=U[1],w=(0,m.useContext)(A),j=w.localUid,F=w.localAudioTrack,G=w.localVideoTrack,H=w.dispatch,B=w.channelJoined,Y=function e(){try{var n=t.tokenUrl,o=function(){if(n){var t=T(function(){return Promise.resolve(fetch(n+"/rtm/"+((null==r?void 0:r.uid)||f.current))).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtmToken;return Promise.resolve(a.login({uid:(null==r?void 0:r.uid)||f.current,token:n})).then(function(){E.current=5})})})},function(){setTimeout(function(){try{return E.current=E.current+E.current,e(),Promise.resolve()}catch(e){return Promise.reject(e)}},1e3*E.current)});if(t&&t.then)return t.then(function(){})}else{var o=T(function(){return Promise.resolve(a.login({uid:(null==r?void 0:r.uid)||f.current,token:(null==r?void 0:r.token)||void 0})).then(function(){E.current=5})},function(){setTimeout(function(){try{return E.current=E.current+E.current,e(),Promise.resolve()}catch(e){return Promise.reject(e)}},1e3*E.current)});if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},J=function e(){try{var n=T(function(){return Promise.resolve(c.join()).then(function(){E.current=5})},function(){setTimeout(function(){try{return E.current=E.current+E.current,e(),Promise.resolve()}catch(e){return Promise.reject(e)}},1e3*E.current)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},z=function(){try{if(V(l.initialising),t.uid?f.current=String(t.uid):f.current=String(new Date().getTime()),a.on("ConnectionStateChanged",function(e,n){console.log(e,n)}),a.on("TokenExpired",function(){try{var e=t.tokenUrl;console.log("token expired - renewing");var n=function(){if(e){var n=T(function(){return Promise.resolve(fetch(e+"/rtm/"+((null==r?void 0:r.uid)||f.current))).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtmToken;return Promise.resolve(a.renewToken(n)).then(function(){E.current=5})})})},function(e){console.error("TokenExpiredError",e)});if(n&&n.then)return n.then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}),a.on("MessageFromPeer",function(e,n){Q(e,n)}),c.on("ChannelMessage",function(e,n){Q(e,n)}),c.on("MemberJoined",function(e){try{return Promise.resolve(eo(Z(),e)).then(function(){})}catch(e){return Promise.reject(e)}}),c.on("MemberCountUpdated",function(e){try{return console.log("RTM-MemberCountUpdated: ",e),Promise.resolve()}catch(e){return Promise.reject(e)}}),null!=_&&_.channel?Object.keys(_.channel).map(function(e){_.channel&&c.on(e,_.channel[e])}):null!=_&&_.client&&Object.keys(_.client).map(function(e){_.client&&a.on(e,_.client[e])}),t.tokenUrl){var e=t.tokenUrl,n=t.uid;a.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(e+"/rtm/"+(n||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){var n=e.rtmToken;a.renewToken(n)})})}catch(e){return Promise.reject(e)}})}return V(l.loggingIn),Promise.resolve(Y()).then(function(){return V(l.loggedIn),Promise.resolve(J()).then(function(){V(l.connected),O(function(e){return S({},e,{0:null==r?void 0:r.username})}),er(Z())})})}catch(e){return Promise.reject(e)}},Z=function(){return{messageType:"UserData",rtmId:(null==r?void 0:r.uid)||f.current,rtcId:j.current,username:null==r?void 0:r.username,role:+("audience"===t.role),uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:I.VERSION,rtc:h.VERSION}}},Q=function(e,n){var t;if("RAW"===e.messageType?t=eR(e.rawMessage):"TEXT"===e.messageType&&(t=JSON.parse(e.text)),console.log(t,n),t)switch(t.messageType){case"UserData":$(t);break;case"MuteRequest":ee(t);break;case"RtmDataRequest":switch(t.type){case"ping":en(n);break;case"userData":et(n);break;default:console.log(n)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},$=function(e){y(function(n){var t;return S({},n,((t={})[e.rtcId]=e.rtmId,t))}),O(function(n){var t;return S({},n,((t={})[e.rtcId]=e.username,t))}),b(function(n){var t;return S({},n,((t={})[e.rtmId]=e,t))})},ee=function(e){j.current===e.rtcId&&(e.isForceful?e.mute?e.device===s.microphone?F&&K(v,H,F):e.device===s.camera&&G&&X(v,H,G):console.error("cannot force unmute"):e.device===s.microphone?e.mute?k(d.muteMic):k(d.unmuteMic):e.device===s.camera&&(e.mute?k(d.muteCamera):k(d.unmuteCamera)))},en=function(e){eo({messageType:"RtmDataRequest",type:"pong"},e)},et=function(e){eo(Z(),e)},er=function(e){try{var n=a.createMessage({text:JSON.stringify(e),messageType:I.MessageType.TEXT}),t=T(function(){return Promise.resolve(c.sendMessage(n)).then(function(){})},function(e){console.error(e)});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},eo=function(e,n){try{var t=a.createMessage({text:JSON.stringify(e),messageType:I.MessageType.TEXT}),r=T(function(){return Promise.resolve(a.sendMessageToPeer(t,String(n))).then(function(){})},function(e){console.error(e)});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},ei=function(){try{return Promise.resolve(a.logout()).then(function(){return Promise.resolve(a.removeAllListeners()).then(function(){})})}catch(e){return Promise.reject(e)}};return(0,m.useEffect)(function(){return B&&(z(),u(!0)),function(){B&&ei()}},[t.channel,t.appId,B]),m.createElement(q,{value:{rtmStatus:M,sendPeerMessage:eo,sendChannelMessage:er,sendMuteRequest:function(e,n,t){var o=(null==r?void 0:r.showPopUpBeforeRemoteMute)===!1,i=p[n];o&&!t?console.log("cannot send force unmute request"):i?eo({messageType:"MuteRequest",device:e,rtcId:n,mute:t,isForceful:o},i):console.log("peer not found")},rtmClient:a,uidMap:p,usernames:N,userDataMap:x,popUpState:L,setPopUpState:k}},i?e.children:m.createElement(m.Fragment,null))};new TextEncoder;var e_=new TextDecoder,eR=function(e){return JSON.parse(e_.decode(e))};function eI(){var e=(0,m.useContext)(C).styleProps,n=(0,m.useContext)(Q),t=n.popUpState,r=n.setPopUpState,o=(e||{}).popUpContainer,i=(0,m.useContext)(A),u=i.dispatch,a=i.localVideoTrack,l=i.localAudioTrack,c=(0,m.useContext)(W);return t!==d.closed?m.createElement("div",{style:S({},eS.container,o)},m.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},t===d.muteCamera||t===d.muteMic?"Mute ":"Unmute ",t===d.muteCamera||t===d.unmuteCamera?"Camera":"Mic","?"),m.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},m.createElement("div",{onClick:function(){switch(t){case d.muteCamera:c.hasVideo&&a&&X(c,u,a);break;case d.muteMic:c.hasAudio&&l&&K(c,u,l);break;case d.unmuteCamera:!c.hasVideo&&a&&X(c,u,a);break;case d.unmuteMic:!c.hasAudio&&l&&K(c,u,l)}r(d.closed)},style:eS.button},"Confirm"),m.createElement("div",{style:eS.buttonClose,onClick:function(){return r(d.closed)}},"Close"))):null}var eS={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},eT=function(){var e=(0,m.useContext)(C).rtcProps;return m.createElement(j,{callActive:e.callActive},m.createElement(B,null,e.disableRtm?m.createElement(m.Fragment,null,(null==e?void 0:e.layout)===u.grid?m.createElement(ed,null):m.createElement(es,null),m.createElement(Z,null)):m.createElement(eh,null,m.createElement(eI,null),(null==e?void 0:e.layout)===u.grid?m.createElement(ed,null):m.createElement(es,null),m.createElement(Z,null))))},eA={display:"flex",flex:1,minHeight:0,flexDirection:"column"};let ep=function(e){var n=e.styleProps,t=e.rtcProps,r=(n||{}).UIKitContainer;return m.createElement(y,{value:e},m.createElement("div",{style:S({},eA,r)},"audience"===t.role?m.createElement(eT,null):m.createElement(ef,null,m.createElement(eT,null))))}}}]);